/*! Copyright 2003-2022 Rustici Software, LLC All Rights Reserved. Rustici-Engine 21.1.1 2023-10-04T17:28:19+0000 4e6e4eb cmi5js */

!function(t){var e="object"==typeof exports&&exports,n="object"==typeof module&&module&&module.exports==e&&module,r="object"==typeof global&&global;r.global!==r&&r.window!==r||(t=r);var i,o,y=2147483647,m=36,b=1,S=26,s=38,a=700,w=72,_=128,T="-",l=/^xn--/,c=/[^ -~]/,u=/\x2E|\u3002|\uFF0E|\uFF61/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=m-b,x=Math.floor,O=String.fromCharCode;function C(t){throw RangeError(h[t])}function f(t,e){for(var n=t.length;n--;)t[n]=e(t[n]);return t}function d(t,e){return f(t.split(u),e).join(".")}function A(t){for(var e,n,r=[],i=0,o=t.length;i<o;)55296<=(e=t.charCodeAt(i++))&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function P(t){return f(t,function(t){var e="";return 65535<t&&(e+=O((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=O(t)}).join("")}function R(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function E(t,e,n){var r=0;for(t=n?x(t/a):t>>1,t+=x(t/e);p*S>>1<t;r+=m)t=x(t/p);return x(r+(p+1)*t/(t+s))}function g(t){var e,n,r,i,o,s,a,l,c,u,h=[],p=t.length,f=0,d=_,g=w,v=t.lastIndexOf(T);for(v<0&&(v=0),n=0;n<v;++n)128<=t.charCodeAt(n)&&C("not-basic"),h.push(t.charCodeAt(n));for(r=0<v?v+1:0;r<p;){for(i=f,o=1,s=m;p<=r&&C("invalid-input"),u=t.charCodeAt(r++),(m<=(a=u-48<10?u-22:u-65<26?u-65:u-97<26?u-97:m)||a>x((y-f)/o))&&C("overflow"),f+=a*o,!(a<(l=s<=g?b:g+S<=s?S:s-g));s+=m)o>x(y/(c=m-l))&&C("overflow"),o*=c;g=E(f-i,e=h.length+1,0==i),x(f/e)>y-d&&C("overflow"),d+=x(f/e),f%=e,h.splice(f++,0,d)}return P(h)}function v(t){for(var e,n,r,i,o,s,a,l,c,u,h,p=[],f=(t=A(t)).length,d=_,g=w,v=e=0;v<f;++v)(l=t[v])<128&&p.push(O(l));for(n=r=p.length,r&&p.push(T);n<f;){for(i=y,v=0;v<f;++v)d<=(l=t[v])&&l<i&&(i=l);for(i-d>x((y-e)/(c=n+1))&&C("overflow"),e+=(i-d)*c,d=i,v=0;v<f;++v)if((l=t[v])<d&&++e>y&&C("overflow"),l==d){for(o=e,s=m;!(o<(a=s<=g?b:g+S<=s?S:s-g));s+=m)h=o-a,u=m-a,p.push(O(R(a+h%u,0))),o=x(h/u);p.push(O(R(o,0))),g=E(e,c,n==r),e=0,++n}++e,++d}return p.join("")}if(i={version:"1.2.3",ucs2:{decode:A,encode:P},decode:g,encode:v,toASCII:function(t){return d(t,function(t){return c.test(t)?"xn--"+v(t):t})},toUnicode:function(t){return d(t,function(t){return l.test(t)?g(t.slice(4).toLowerCase()):t})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return i});else if(e&&!e.nodeType)if(n)n.exports=i;else for(o in i)i.hasOwnProperty(o)&&(e[o]=i[o]);else t.punycode=i}(this),function(t,e){"use strict";"object"==typeof exports?module.exports=e(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],e):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)}(this,function(a,e,c,n){"use strict";var r=n&&n.URI;function f(t,e){if(!(this instanceof f))return new f(t,e);if(void 0===t){if(arguments.length)throw new TypeError("undefined is not a valid argument for URI");t="undefined"!=typeof location?location.href+"":""}return this.href(t),void 0!==e?this.absoluteTo(e):this}f.version="1.14.2";var t=f.prototype,u=Object.prototype.hasOwnProperty;function l(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function o(t){return void 0===t?"Undefined":String(Object.prototype.toString.call(t)).slice(8,-1)}function h(t){return"Array"===o(t)}function s(t,e){if(h(e)){for(r=0,i=e.length;r<i;r++)if(!s(t,e[r]))return!1;return!0}for(var n=o(e),r=0,i=t.length;r<i;r++)if("RegExp"===n){if("string"==typeof t[r]&&t[r].match(e))return!0}else if(t[r]===e)return!0;return!1}function p(t,e){if(!h(t)||!h(e))return!1;if(t.length!==e.length)return!1;t.sort(),e.sort();for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function i(t){return escape(t)}function d(t){return encodeURIComponent(t).replace(/[!'()*]/g,i).replace(/\*/g,"%2A")}function g(t){for(var e,n=a.ucs2.decode(t),r="",i=0;i<n.length;i++){var o=n[i];45===(e=o)||46===e||95===e||126===e||48<=e&&e<64||65<=e&&e<91||97<=e&&e<123||160<=e&&e<55296||57344<=e&&e<63743||63744<=e&&e<64976||65008<=e&&e<65520||65536<=e&&e<131070||131072<=e&&e<196606||196608<=e&&e<262142||262144<=e&&e<327678||327680<=e&&e<393214||393216<=e&&e<458750||458752<=e&&e<524286||524288<=e&&e<589822||589824<=e&&e<655358||655360<=e&&e<720894||720896<=e&&e<786430||786432<=e&&e<851966||851968<=e&&e<917502||917504<=e&&e<983038||983040<=e&&e<1048574||1048576<=e&&e<1114110?r+=a.ucs2.encode([o]):r+=d(a.ucs2.encode([o]))}return r}function v(t){return f.punycode_expression.test(t)&&(t=a.toUnicode(t)),g(t)}f._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:f.duplicateQueryParameters,escapeQuerySpace:f.escapeQuerySpace}},f.duplicateQueryParameters=!1,f.escapeQuerySpace=!0,f.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,f.idn_expression=/[^a-z0-9\.-]/i,f.punycode_expression=/(xn--)/i,f.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,f.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,f.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»]))/gi,f.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»]+$/},f.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},f.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,f.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},f.getDomAttribute=function(t){if(t&&t.nodeName){var e=t.nodeName.toLowerCase();if("input"!==e||"image"===t.type)return f.domAttributes[e]}},f._defaultRecodeHostname=a?a.toASCII:function(t){return t},f.iso8859=function(){f.recodeHostname=f._defaultRecodeHostname,f.encode=escape,f.decode=unescape},f.unicode=function(){f.recodeHostname=f._defaultRecodeHostname,f.encode=d,f.decode=decodeURIComponent},f.iri=function(){f.recodeHostname=v,f.encode=g,f.decode=decodeURIComponent},f.unicode(),f.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},f.encodeQuery=function(t,e){var n=f.encode(t+"");return void 0===e&&(e=f.escapeQuerySpace),e?n.replace(/%20/g,"+"):n},f.decodeQuery=function(e,t){e+="",void 0===t&&(t=f.escapeQuerySpace);try{return f.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};function y(n,r){return function(e){try{return f[r](e+"").replace(f.characters[n][r].expression,function(t){return f.characters[n][r].map[t]})}catch(t){return e}}}var m,b={encode:"encode",decode:"decode"};for(m in b)f[m+"PathSegment"]=y("pathname",b[m]),f[m+"UrnPathSegment"]=y("urnpath",b[m]);function S(o,s,a){return function(t){for(var e=a?function(t){return f[s](f[a](t))}:f[s],n=(t+"").split(o),r=0,i=n.length;r<i;r++)n[r]=e(n[r]);return n.join(o)}}function w(n){return function(t,e){return void 0===t?this._parts[n]||"":(this._parts[n]=t||null,this.build(!e),this)}}function _(n,r){return function(t,e){return void 0===t?this._parts[n]||"":(null!==t&&(t+="").charAt(0)===r&&(t=t.substring(1)),this._parts[n]=t,this.build(!e),this)}}f.decodePath=S("/","decodePathSegment"),f.decodeUrnPath=S(":","decodeUrnPathSegment"),f.recodePath=S("/","encodePathSegment","decode"),f.recodeUrnPath=S(":","encodeUrnPathSegment","decode"),f.encodeReserved=y("reserved","encode"),f.parse=function(t,e){var n;return e=e||{},-1<(n=t.indexOf("#"))&&(e.fragment=t.substring(n+1)||null,t=t.substring(0,n)),-1<(n=t.indexOf("?"))&&(e.query=t.substring(n+1)||null,t=t.substring(0,n)),"//"===t.substring(0,2)?(e.protocol=null,t=t.substring(2),t=f.parseAuthority(t,e)):-1<(n=t.indexOf(":"))&&(e.protocol=t.substring(0,n)||null,e.protocol&&!e.protocol.match(f.protocol_expression)?e.protocol=void 0:"//"===t.substring(n+1,n+3)?(t=t.substring(n+3),t=f.parseAuthority(t,e)):(t=t.substring(n+1),e.urn=!0)),e.path=t,e},f.parseHost=function(t,e){var n,r,i,o,s,a=t.indexOf("/");return-1===a&&(a=t.length),"["===t.charAt(0)?(n=t.indexOf("]"),e.hostname=t.substring(1,n)||null,e.port=t.substring(n+2,a)||null,"/"===e.port&&(e.port=null)):(i=t.indexOf(":"),o=t.indexOf("/"),-1!==(s=t.indexOf(":",i+1))&&(-1===o||s<o)?(e.hostname=t.substring(0,a)||null,e.port=null):(r=t.substring(0,a).split(":"),e.hostname=r[0]||null,e.port=r[1]||null)),e.hostname&&"/"!==t.substring(a).charAt(0)&&(a++,t="/"+t),t.substring(a)||"/"},f.parseAuthority=function(t,e){return t=f.parseUserinfo(t,e),f.parseHost(t,e)},f.parseUserinfo=function(t,e){var n,r=t.indexOf("/"),i=t.lastIndexOf("@",-1<r?r:t.length-1);return-1<i&&(-1===r||i<r)?(n=t.substring(0,i).split(":"),e.username=n[0]?f.decode(n[0]):null,n.shift(),e.password=n[0]?f.decode(n.join(":")):null,t=t.substring(i+1)):(e.username=null,e.password=null),t},f.parseQuery=function(t,e){if(!t)return{};if(!(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var n,r,i,o={},s=t.split("&"),a=s.length,l=0;l<a;l++)n=s[l].split("="),r=f.decodeQuery(n.shift(),e),i=n.length?f.decodeQuery(n.join("="),e):null,u.call(o,r)?("string"==typeof o[r]&&(o[r]=[o[r]]),o[r].push(i)):o[r]=i;return o},f.build=function(t){var e="";return t.protocol&&(e+=t.protocol+":"),t.urn||!e&&!t.hostname||(e+="//"),e+=f.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path.charAt(0)&&"string"==typeof t.hostname&&(e+="/"),e+=t.path),"string"==typeof t.query&&t.query&&(e+="?"+t.query),"string"==typeof t.fragment&&t.fragment&&(e+="#"+t.fragment),e},f.buildHost=function(t){var e="";return t.hostname?(f.ip6_expression.test(t.hostname)?e+="["+t.hostname+"]":e+=t.hostname,t.port&&(e+=":"+t.port),e):""},f.buildAuthority=function(t){return f.buildUserinfo(t)+f.buildHost(t)},f.buildUserinfo=function(t){var e="";return t.username&&(e+=f.encode(t.username),t.password&&(e+=":"+f.encode(t.password)),e+="@"),e},f.buildQuery=function(t,e,n){var r,i,o,s,a="";for(i in t)if(u.call(t,i)&&i)if(h(t[i]))for(r={},o=0,s=t[i].length;o<s;o++)void 0!==t[i][o]&&void 0===r[t[i][o]+""]&&(a+="&"+f.buildQueryParameter(i,t[i][o],n),!0!==e&&(r[t[i][o]+""]=!0));else void 0!==t[i]&&(a+="&"+f.buildQueryParameter(i,t[i],n));return a.substring(1)},f.buildQueryParameter=function(t,e,n){return f.encodeQuery(t,n)+(null!==e?"="+f.encodeQuery(e,n):"")},f.addQuery=function(t,e,n){if("object"==typeof e)for(var r in e)u.call(e,r)&&f.addQuery(t,r,e[r]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===t[e])return void(t[e]=n);"string"==typeof t[e]&&(t[e]=[t[e]]),h(n)||(n=[n]),t[e]=(t[e]||[]).concat(n)}},f.removeQuery=function(t,e,n){var r,i,o;if(h(e))for(r=0,i=e.length;r<i;r++)t[e[r]]=void 0;else if("object"==typeof e)for(o in e)u.call(e,o)&&f.removeQuery(t,o,e[o]);else{if("string"!=typeof e)throw new TypeError("URI.removeQuery() accepts an object, string as the first parameter");void 0===n||t[e]===n?t[e]=void 0:h(t[e])&&(t[e]=function(t,e){var n,r,i={};if(h(e))for(n=0,r=e.length;n<r;n++)i[e[n]]=!0;else i[e]=!0;for(n=0,r=t.length;n<r;n++)void 0!==i[t[n]]&&(t.splice(n,1),r--,n--);return t}(t[e],n))}},f.hasQuery=function(t,e,n,r){if("object"==typeof e){for(var i in e)if(u.call(e,i)&&!f.hasQuery(t,i,e[i]))return!1;return!0}if("string"!=typeof e)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(o(n)){case"Undefined":return e in t;case"Boolean":return n===Boolean(h(t[e])?t[e].length:t[e]);case"Function":return!!n(t[e],e,t);case"Array":return h(t[e])?(r?s:p)(t[e],n):!1;case"RegExp":return h(t[e])?!!r&&s(t[e],n):Boolean(t[e]&&t[e].match(n));case"Number":n=String(n);case"String":return h(t[e])?!!r&&s(t[e],n):t[e]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},f.commonPath=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++)if(t.charAt(r)!==e.charAt(r)){r--;break}return r<1?t.charAt(0)===e.charAt(0)&&"/"===t.charAt(0)?"/":"":("/"===t.charAt(r)&&"/"===e.charAt(r)||(r=t.substring(0,r).lastIndexOf("/")),t.substring(0,r+1))},f.withinString=function(t,e,n){var r=(n=n||{}).start||f.findUri.start,i=n.end||f.findUri.end,o=n.trim||f.findUri.trim,s=/[a-z0-9-]=["']?$/i;for(r.lastIndex=0;;){var a=r.exec(t);if(!a)break;var l=a.index;if(n.ignoreHtml){var c=t.slice(Math.max(l-3,0),l);if(c&&s.test(c))continue}var u,h=l+t.slice(l).search(i),p=t.slice(l,h).replace(o,"");n.ignore&&n.ignore.test(p)||(u=e(p,l,h=l+p.length,t),t=t.slice(0,l)+u+t.slice(h),r.lastIndex=l+u.length)}return r.lastIndex=0,t},f.ensureValidHostname=function(t){if(t.match(f.invalid_hostname_characters)){if(!a)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(a.toASCII(t).match(f.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]')}},f.noConflict=function(t){if(t){var e={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(e.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(e.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(e.SecondLevelDomains=n.SecondLevelDomains.noConflict()),e}return n.URI===this&&(n.URI=r),this},t.build=function(t){return!0===t?this._deferred_build=!0:void 0!==t&&!this._deferred_build||(this._string=f.build(this._parts),this._deferred_build=!1),this},t.clone=function(){return new f(this)},t.valueOf=t.toString=function(){return this.build(!1)._string},t.protocol=w("protocol"),t.username=w("username"),t.password=w("password"),t.hostname=w("hostname"),t.port=w("port"),t.query=_("query","?"),t.fragment=_("fragment","#"),t.search=function(t,e){var n=this.query(t,e);return"string"==typeof n&&n.length?"?"+n:n},t.hash=function(t,e){var n=this.fragment(t,e);return"string"==typeof n&&n.length?"#"+n:n},t.pathname=function(t,e){if(void 0!==t&&!0!==t)return this._parts.urn?this._parts.path=t?f.recodeUrnPath(t):"":this._parts.path=t?f.recodePath(t):"/",this.build(!e),this;var n=this._parts.path||(this._parts.hostname?"/":"");return t?(this._parts.urn?f.decodeUrnPath:f.decodePath)(n):n},t.path=t.pathname,t.href=function(t,e){var n;if(void 0===t)return this.toString();this._string="",this._parts=f._parts();var r=t instanceof f,i="object"==typeof t&&(t.hostname||t.path||t.pathname);if(t.nodeName&&(t=t[f.getDomAttribute(t)]||"",i=!1),!r&&i&&void 0!==t.pathname&&(t=t.toString()),"string"==typeof t||t instanceof String)this._parts=f.parse(String(t),this._parts);else{if(!r&&!i)throw new TypeError("invalid input");var o=r?t._parts:t;for(n in o)u.call(this._parts,n)&&(this._parts[n]=o[n])}return this.build(!e),this},t.is=function(t){var e=!1,n=!1,r=!1,i=!1,o=!1,s=!1,a=!1,l=!this._parts.urn;switch(this._parts.hostname&&(l=!1,n=f.ip4_expression.test(this._parts.hostname),r=f.ip6_expression.test(this._parts.hostname),o=(i=!(e=n||r))&&c&&c.has(this._parts.hostname),s=i&&f.idn_expression.test(this._parts.hostname),a=i&&f.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return i;case"sld":return o;case"ip":return e;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return r;case"idn":return s;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return a}return null};var T=t.protocol,x=t.port,O=t.hostname;t.protocol=function(t,e){if(void 0!==t&&t&&!(t=t.replace(/:(\/\/)?$/,"")).match(f.protocol_expression))throw new TypeError('Protocol "'+t+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return T.call(this,t,e)},t.scheme=t.protocol,t.port=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t&&(0===t&&(t=null),t&&(":"===(t+="").charAt(0)&&(t=t.substring(1)),t.match(/[^0-9]/))))throw new TypeError('Port "'+t+'" contains characters other than [0-9]');return x.call(this,t,e)},t.hostname=function(t,e){return this._parts.urn?void 0===t?"":this:(void 0!==t&&(f.parseHost(t,n={}),t=n.hostname),O.call(this,t,e));var n},t.host=function(t,e){return this._parts.urn?void 0===t?"":this:void 0===t?this._parts.hostname?f.buildHost(this._parts):"":(f.parseHost(t,this._parts),this.build(!e),this)},t.authority=function(t,e){return this._parts.urn?void 0===t?"":this:void 0===t?this._parts.hostname?f.buildAuthority(this._parts):"":(f.parseAuthority(t,this._parts),this.build(!e),this)},t.userinfo=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t)return"@"!==t[t.length-1]&&(t+="@"),f.parseUserinfo(t,this._parts),this.build(!e),this;if(!this._parts.username)return"";var n=f.buildUserinfo(this._parts);return n.substring(0,n.length-1)},t.resource=function(t,e){var n;return void 0===t?this.path()+this.search()+this.hash():(n=f.parse(t),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!e),this)},t.subdomain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var r=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,r),o=new RegExp("^"+l(i));return t&&"."!==t.charAt(t.length-1)&&(t+="."),t&&f.ensureValidHostname(t),this._parts.hostname=this._parts.hostname.replace(o,t),this.build(!e),this},t.domain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var r=this._parts.hostname.length-this.tld(e).length-1,r=this._parts.hostname.lastIndexOf(".",r-1)+1;return this._parts.hostname.substring(r)||""}if(!t)throw new TypeError("cannot set domain empty");var i;return f.ensureValidHostname(t),!this._parts.hostname||this.is("IP")?this._parts.hostname=t:(i=new RegExp(l(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(i,t)),this.build(!e),this},t.tld=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),r=this._parts.hostname.substring(n+1);return!0!==e&&c&&c.list[r.toLowerCase()]?c.get(this._parts.hostname)||r:r}var i;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!c||!c.is(t))throw new TypeError('TLD "'+t+'" contains characters other than [A-Z0-9]');i=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(i,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");i=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(i,t)}return this.build(!e),this},t.directory=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,r=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return t?f.decodePath(r):r}var i=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,i),s=new RegExp("^"+l(o));return this.is("relative")||"/"!==(t=t||"/").charAt(0)&&(t="/"+t),t&&"/"!==t.charAt(t.length-1)&&(t+="/"),t=f.recodePath(t),this._parts.path=this._parts.path.replace(s,t),this.build(!e),this},t.filename=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),r=this._parts.path.substring(n+1);return t?f.decodePathSegment(r):r}var i=!1;"/"===t.charAt(0)&&(t=t.substring(1)),t.match(/\.?\//)&&(i=!0);var o=new RegExp(l(this.filename())+"$");return t=f.recodePath(t),this._parts.path=this._parts.path.replace(o,t),i?this.normalizePath(e):this.build(!e),this},t.suffix=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path||"/"===this._parts.path)return"";var n,r,i=this.filename(),o=i.lastIndexOf(".");return-1===o?"":(n=i.substring(o+1),r=/^[a-z0-9%]+$/i.test(n)?n:"",t?f.decodePathSegment(r):r)}"."===t.charAt(0)&&(t=t.substring(1));var s,a=this.suffix();if(a)s=t?new RegExp(l(a)+"$"):new RegExp(l("."+a)+"$");else{if(!t)return this;this._parts.path+="."+f.recodePath(t)}return s&&(t=f.recodePath(t),this._parts.path=this._parts.path.replace(s,t)),this.build(!e),this},t.segment=function(t,e,n){var r=this._parts.urn?":":"/",i=this.path(),o="/"===i.substring(0,1),s=i.split(r);if(void 0!==t&&"number"!=typeof t&&(n=e,e=t,t=void 0),void 0!==t&&"number"!=typeof t)throw new Error('Bad segment "'+t+'", must be 0-based integer');if(o&&s.shift(),t<0&&(t=Math.max(s.length+t,0)),void 0===e)return void 0===t?s:s[t];if(null===t||void 0===s[t])if(h(e)){s=[];for(var a=0,l=e.length;a<l;a++)(e[a].length||s.length&&s[s.length-1].length)&&(s.length&&!s[s.length-1].length&&s.pop(),s.push(e[a]))}else!e&&"string"!=typeof e||(""===s[s.length-1]?s[s.length-1]=e:s.push(e));else e?s[t]=e:s.splice(t,1);return o&&s.unshift(""),this.path(s.join(r),n)},t.segmentCoded=function(t,e,n){var r,i,o;if("number"!=typeof t&&(n=e,e=t,t=void 0),void 0===e){if(h(r=this.segment(t,e,n)))for(i=0,o=r.length;i<o;i++)r[i]=f.decode(r[i]);else r=void 0!==r?f.decode(r):void 0;return r}if(h(e))for(i=0,o=e.length;i<o;i++)e[i]=f.decode(e[i]);else e="string"==typeof e||e instanceof String?f.encode(e):e;return this.segment(t,e,n)};var C=t.query;function A(t,r,i){return function(){var t=f.recodeHostname,e=f.encode,n=f.decode;f.encode=r,f.decode=i;try{this.normalize()}finally{f.recodeHostname=t,f.encode=e,f.decode=n}return this}}return t.query=function(t,e){if(!0===t)return f.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"!=typeof t)return void 0!==t&&"string"!=typeof t?(this._parts.query=f.buildQuery(t,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this):C.call(this,t,e);var n=f.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=t.call(this,n);return this._parts.query=f.buildQuery(r||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this},t.setQuery=function(t,e,n){var r=f.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof t||t instanceof String)r[t]=void 0!==e?e:null;else{if("object"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in t)u.call(t,i)&&(r[i]=t[i])}return this._parts.query=f.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(n=e),this.build(!n),this},t.addQuery=function(t,e,n){var r=f.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return f.addQuery(r,t,void 0===e?null:e),this._parts.query=f.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(n=e),this.build(!n),this},t.removeQuery=function(t,e,n){var r=f.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return f.removeQuery(r,t,e),this._parts.query=f.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(n=e),this.build(!n),this},t.hasQuery=function(t,e,n){var r=f.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return f.hasQuery(r,t,e,n)},t.setSearch=t.setQuery,t.addSearch=t.addQuery,t.removeSearch=t.removeQuery,t.hasSearch=t.hasQuery,t.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},t.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},t.normalizeHostname=function(t){return this._parts.hostname&&(this.is("IDN")||this.is("punycode")?this._parts.hostname=f.recodeHostname(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!t)),this},t.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===f.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},t.normalizePath=function(t){var e,n=this._parts.path;if(!n)return this;if(this._parts.urn)return this._parts.path=f.recodeUrnPath(this._parts.path),this.build(!t),this;if("/"===this._parts.path)return this;var r,i,o="";for("/"!==n.charAt(0)&&(e=!0,n="/"+n),n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),e&&(o=(o=n.substring(1).match(/^(\.\.\/)+/)||"")&&o[0]);-1!==(r=n.indexOf("/.."));)n=0!==r?(-1===(i=n.substring(0,r).lastIndexOf("/"))&&(i=r),n.substring(0,i)+n.substring(r+3)):n.substring(3);return e&&this.is("relative")&&(n=o+n.substring(1)),n=f.recodePath(n),this._parts.path=n,this.build(!t),this},t.normalizePathname=t.normalizePath,t.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(f.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!t)),this},t.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},t.normalizeSearch=t.normalizeQuery,t.normalizeHash=t.normalizeFragment,t.iso8859=A(0,escape,decodeURIComponent),t.unicode=A(0,d,unescape),t.iri=A(0,g,decodeURIComponent),t.readable=function(){var t=this.clone();t.username("").password("").normalize();var e="";if(t._parts.protocol&&(e+=t._parts.protocol+(t._parts.urn?":":"://")),t._parts.hostname&&(t.is("punycode")&&a?(e+=a.toUnicode(t._parts.hostname),t._parts.port&&(e+=":"+t._parts.port)):e+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(e+="/"),e+=t.path(!0),t._parts.query){for(var n="",r=0,i=t._parts.query.split("&"),o=i.length;r<o;r++){var s=(i[r]||"").split("=");n+="&"+f.decodeQuery(s[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==s[1]&&(n+="="+f.decodeQuery(s[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}e+="?"+n.substring(1)}return e+=f.decodeQuery(t.hash(),!0)},t.absoluteTo=function(t){var e,n,r,i=this.clone(),o=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t instanceof f||(t=new f(t)),i._parts.protocol||(i._parts.protocol=t._parts.protocol),this._parts.hostname)return i;for(n=0;r=o[n];n++)i._parts[r]=t._parts[r];return i._parts.path?".."===i._parts.path.substring(-2)&&(i._parts.path+="/"):(i._parts.path=t._parts.path,i._parts.query||(i._parts.query=t._parts.query)),"/"!==i.path().charAt(0)&&(e=t.directory(),i._parts.path=(e?e+"/":"")+i._parts.path,i.normalizePath()),i.build(),i},t.relativeTo=function(t){var e,n,r,i,o,s=this.clone().normalize();if(s._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t=new f(t).normalize(),e=s._parts,n=t._parts,i=s.path(),o=t.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==o.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(e.protocol===n.protocol&&(e.protocol=null),e.username!==n.username||e.password!==n.password)return s.build();if(null!==e.protocol||null!==e.username||null!==e.password)return s.build();if(e.hostname!==n.hostname||e.port!==n.port)return s.build();if(e.hostname=null,e.port=null,i===o)return e.path="",s.build();if(!(r=f.commonPath(s.path(),t.path())))return s.build();var a=n.path.substring(r.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return e.path=a+e.path.substring(r.length),s.build()},t.equals=function(t){var e,n,r,i,o,s=this.clone(),a=new f(t),l={};if(s.normalize(),a.normalize(),s.toString()===a.toString())return!0;if(r=s.query(),i=a.query(),s.query(""),a.query(""),s.toString()!==a.toString())return!1;if(r.length!==i.length)return!1;for(o in e=f.parseQuery(r,this._parts.escapeQuerySpace),n=f.parseQuery(i,this._parts.escapeQuerySpace),e)if(u.call(e,o)){if(h(e[o])){if(!p(e[o],n[o]))return!1}else if(e[o]!==n[o])return!1;l[o]=!0}for(o in n)if(u.call(n,o)&&!l[o])return!1;return!0},t.duplicateQueryParameters=function(t){return this._parts.duplicateQueryParameters=!!t,this},t.escapeQuerySpace=function(t){return this._parts.escapeQuerySpace=!!t,this},f});var CryptoJS=CryptoJS||function(a){function n(){}var t={},e=t.lib={},r=e.Base={extend:function(t){n.prototype=this;var e=new n;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),(e.init.prototype=e).$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},l=e.WordArray=r.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||o).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes;if(t=t.sigBytes,this.clamp(),r%4)for(var i=0;i<t;i++)e[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<t;i+=4)e[r+i>>>2]=n[i>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var t=this.words,e=this.sigBytes;t[e>>>2]&=4294967295<<32-e%4*8,t.length=a.ceil(e/4)},clone:function(){var t=r.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(4294967296*a.random()|0);return new l.init(e,t)}}),i=t.enc={},o=i.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;r<t;r++){var i=e[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new l.init(n,e/2)}},s=i.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;r<t;r++)n.push(String.fromCharCode(e[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new l.init(n,e)}},c=i.Utf8={stringify:function(t){try{return decodeURIComponent(escape(s.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return s.parse(unescape(encodeURIComponent(t)))}},u=e.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var e=this._data,n=e.words,r=e.sigBytes,i=this.blockSize,o=r/(4*i);if(t=(o=t?a.ceil(o):a.max((0|o)-this._minBufferSize,0))*i,r=a.min(4*t,r),t){for(var s=0;s<t;s+=i)this._doProcessBlock(n,s);s=n.splice(0,t),e.sigBytes-=r}return new l.init(s,r)},clone:function(){var t=r.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});e.Hasher=u.extend({cfg:r.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(t,e){return new n.init(e).finalize(t)}},_createHmacHelper:function(n){return function(t,e){return new h.HMAC.init(n,e).finalize(t)}}});var h=t.algo={};return t}(Math);!function(){var t=CryptoJS,e=(r=t.lib).WordArray,n=r.Hasher,u=[],r=t.algo.SHA1=n.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n,r=this._hash.words,i=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=0;c<80;c++){c<16?u[c]=0|t[e+c]:(n=u[c-3]^u[c-8]^u[c-14]^u[c-16],u[c]=n<<1|n>>>31),n=(i<<5|i>>>27)+l+u[c],n=c<20?n+(1518500249+(o&s|~o&a)):c<40?n+(1859775393+(o^s^a)):c<60?n+((o&s|o&a|s&a)-1894007588):n+((o^s^a)-899497514),l=a,a=s,s=o<<30|o>>>2,o=i,i=n}r[0]=r[0]+i|0,r[1]=r[1]+o|0,r[2]=r[2]+s|0,r[3]=r[3]+a|0,r[4]=r[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(64+r>>>9<<4)]=Math.floor(n/4294967296),e[15+(64+r>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=n._createHelper(r),t.HmacSHA1=n._createHmacHelper(r)}();var CryptoJS=CryptoJS||function(a){function n(){}var t={},e=t.lib={},r=e.Base={extend:function(t){n.prototype=this;var e=new n;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),(e.init.prototype=e).$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},l=e.WordArray=r.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||o).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes;if(t=t.sigBytes,this.clamp(),r%4)for(var i=0;i<t;i++)e[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<t;i+=4)e[r+i>>>2]=n[i>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var t=this.words,e=this.sigBytes;t[e>>>2]&=4294967295<<32-e%4*8,t.length=a.ceil(e/4)},clone:function(){var t=r.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(4294967296*a.random()|0);return new l.init(e,t)}}),i=t.enc={},o=i.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;r<t;r++){var i=e[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new l.init(n,e/2)}},s=i.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;r<t;r++)n.push(String.fromCharCode(e[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new l.init(n,e)}},c=i.Utf8={stringify:function(t){try{return decodeURIComponent(escape(s.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return s.parse(unescape(encodeURIComponent(t)))}},u=e.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var e=this._data,n=e.words,r=e.sigBytes,i=this.blockSize,o=r/(4*i);if(t=(o=t?a.ceil(o):a.max((0|o)-this._minBufferSize,0))*i,r=a.min(4*t,r),t){for(var s=0;s<t;s+=i)this._doProcessBlock(n,s);s=n.splice(0,t),e.sigBytes-=r}return new l.init(s,r)},clone:function(){var t=r.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});e.Hasher=u.extend({cfg:r.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(t,e){return new n.init(e).finalize(t)}},_createHmacHelper:function(n){return function(t,e){return new h.HMAC.init(n,e).finalize(t)}}});var h=t.algo={};return t}(Math),TinCan,Cmi5;!function(i){function t(t){return 4294967296*(t-(0|t))|0}for(var e,n=CryptoJS,r=(s=n.lib).WordArray,o=s.Hasher,s=n.algo,a=[],d=[],l=2,c=0;c<64;){t:{e=l;for(var u=i.sqrt(e),h=2;h<=u;h++)if(!(e%h)){e=!1;break t}e=!0}e&&(c<8&&(a[c]=t(i.pow(l,.5))),d[c]=t(i.pow(l,1/3)),c++),l++}var g=[],s=s.SHA256=o.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n,r,i=this._hash.words,o=i[0],s=i[1],a=i[2],l=i[3],c=i[4],u=i[5],h=i[6],p=i[7],f=0;f<64;f++){f<16?g[f]=0|t[e+f]:(n=g[f-15],r=g[f-2],g[f]=((n<<25|n>>>7)^(n<<14|n>>>18)^n>>>3)+g[f-7]+((r<<15|r>>>17)^(r<<13|r>>>19)^r>>>10)+g[f-16]),n=p+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&h)+d[f]+g[f],r=((o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22))+(o&s^o&a^s&a),p=h,h=u,u=c,c=l+n|0,l=a,a=s,s=o,o=n+r|0}i[0]=i[0]+o|0,i[1]=i[1]+s|0,i[2]=i[2]+a|0,i[3]=i[3]+l|0,i[4]=i[4]+c|0,i[5]=i[5]+u|0,i[6]=i[6]+h|0,i[7]=i[7]+p|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(64+r>>>9<<4)]=i.floor(n/4294967296),e[15+(64+r>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});n.SHA256=o._createHelper(s),n.HmacSHA256=o._createHmacHelper(s)}(Math),function(){var u=CryptoJS.lib.WordArray;CryptoJS.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp();for(var i=[],o=0;o<n;o+=3)for(var s=(e[o>>>2]>>>24-o%4*8&255)<<16|(e[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|e[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)i.push(r.charAt(s>>>6*(3-a)&63));var l=r.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(t){var e,n=t.length,r=this._map,i=r.charAt(64);!i||-1!=(e=t.indexOf(i))&&(n=e);for(var o,s,a=[],l=0,c=0;c<n;c++){c%4&&(o=r.indexOf(t.charAt(c-1))<<c%4*2,s=r.indexOf(t.charAt(c))>>>6-c%4*2,a[l>>>2]|=(o|s)<<24-l%4*8,l++)}return u.create(a,l)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(){var t,i;"function"==typeof ArrayBuffer&&(t=CryptoJS.lib.WordArray,i=t.init,(t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,n=[],r=0;r<e;r++)n[r>>>2]|=t[r]<<24-r%4*8;i.call(this,n,e)}else i.apply(this,arguments)}).prototype=t)}(),function(){"use strict";var l={statementId:!0,voidedStatementId:!0,verb:!0,object:!0,registration:!0,context:!0,actor:!0,since:!0,until:!0,limit:!0,authoritative:!0,sparse:!0,instructor:!0,ascending:!0,continueToken:!0,agent:!0,activityId:!0,stateId:!0,profileId:!0,activity_platform:!0,grouping:!0,"Accept-Language":!0};(TinCan=function(t){this.log("constructor"),this.recordStores=[],this.actor=null,this.activity=null,this.registration=null,this.context=null,this.init(t)}).prototype={LOG_SRC:"TinCan",log:function(t,e){TinCan.DEBUG&&"undefined"!=typeof console&&console.log&&(e=e||this.LOG_SRC||"TinCan",console.log("TinCan."+e+": "+t))},init:function(t){var e;if(this.log("init"),(t=t||{}).hasOwnProperty("url")&&""!==t.url&&this._initFromQueryString(t.url),t.hasOwnProperty("recordStores")&&void 0!==t.recordStores)for(e=0;e<t.recordStores.length;e+=1)this.addRecordStore(t.recordStores[e]);t.hasOwnProperty("activity")&&(t.activity instanceof TinCan.Activity?this.activity=t.activity:this.activity=new TinCan.Activity(t.activity)),t.hasOwnProperty("actor")&&(t.actor instanceof TinCan.Agent?this.actor=t.actor:this.actor=new TinCan.Agent(t.actor)),t.hasOwnProperty("context")&&(t.context instanceof TinCan.Context?this.context=t.context:this.context=new TinCan.Context(t.context)),t.hasOwnProperty("registration")&&(this.registration=t.registration)},_initFromQueryString:function(t){this.log("_initFromQueryString");var e,n,r,i=TinCan.Utils.parseURL(t).params,o=["endpoint","auth"],s={},a=null;if(i.hasOwnProperty("actor")){this.log("_initFromQueryString - found actor: "+i.actor);try{this.actor=TinCan.Agent.fromJSON(i.actor),delete i.actor}catch(t){this.log("_initFromQueryString - failed to set actor: "+t)}}if(i.hasOwnProperty("activity_id")&&(this.activity=new TinCan.Activity({id:i.activity_id}),delete i.activity_id),(i.hasOwnProperty("activity_platform")||i.hasOwnProperty("registration")||i.hasOwnProperty("grouping"))&&(r={},i.hasOwnProperty("activity_platform")&&(r.platform=i.activity_platform,delete i.activity_platform),i.hasOwnProperty("registration")&&(r.registration=this.registration=i.registration,delete i.registration),i.hasOwnProperty("grouping")&&(r.contextActivities={},r.contextActivities.grouping=i.grouping,delete i.grouping),this.context=new TinCan.Context(r)),i.hasOwnProperty("endpoint")){for(e=0;e<o.length;e+=1)n=o[e],i.hasOwnProperty(n)&&(s[n]=i[n],delete i[n]);for(e in i)i.hasOwnProperty(e)&&(l.hasOwnProperty(e)?delete i[e]:(a=a||{})[e]=i[e]);null!==a&&(s.extended=a),s.allowFail=!1,this.addRecordStore(s)}},addRecordStore:function(t){var e;this.log("addRecordStore"),e=t instanceof TinCan.LRS?t:new TinCan.LRS(t),this.recordStores.push(e)},prepareStatement:function(t){return this.log("prepareStatement"),t instanceof TinCan.Statement||(t=new TinCan.Statement(t)),null===t.actor&&null!==this.actor&&(t.actor=this.actor),null===t.target&&null!==this.activity&&(t.target=this.activity),null!==this.context&&(null===t.context?t.context=this.context:(null===t.context.registration&&(t.context.registration=this.context.registration),null===t.context.platform&&(t.context.platform=this.context.platform),null!==this.context.contextActivities&&(null===t.context.contextActivities?t.context.contextActivities=this.context.contextActivities:(null!==this.context.contextActivities.grouping&&null===t.context.contextActivities.grouping&&(t.context.contextActivities.grouping=this.context.contextActivities.grouping),null!==this.context.contextActivities.parent&&null===t.context.contextActivities.parent&&(t.context.contextActivities.parent=this.context.contextActivities.parent),null!==this.context.contextActivities.other&&null===t.context.contextActivities.other&&(t.context.contextActivities.other=this.context.contextActivities.other))))),t},sendStatement:function(t,r){this.log("sendStatement");var e,n,i,o=this,s=this.prepareStatement(t),a=this.recordStores.length,l=[],c=[];if(0<a)for("function"==typeof r&&(i=function(t,e){var n;o.log("sendStatement - callbackWrapper: "+a),1<a?(--a,c.push({err:t,xhr:e})):1===a?(c.push({err:t,xhr:e}),n=[c,s],r.apply(this,n)):o.log("sendStatement - unexpected record store count: "+a)}),n=0;n<a;n+=1)e=this.recordStores[n],l.push(e.saveStatement(s,{callback:i}));else this.log("[warning] sendStatement: No LRSs added yet (statement not sent)"),"function"==typeof r&&r.apply(this,[null,s]);return{statement:s,results:l}},getStatement:function(t,e,n){if(this.log("getStatement"),(n=n||{}).params=n.params||{},0<this.recordStores.length)return this.recordStores[0].retrieveStatement(t,{callback:e,params:n.params});this.log("[warning] getStatement: No LRSs added yet (statement not retrieved)")},voidStatement:function(t,r,e){this.log("voidStatement");var n,i,o,s,a,l=this,c=this.recordStores.length,u=[],h=[];if(t instanceof TinCan.Statement&&(t=t.id),void 0!==e.actor?i=e.actor:null!==this.actor&&(i=this.actor),o=new TinCan.Statement({actor:i,verb:{id:"http://adlnet.gov/expapi/verbs/voided"},target:{objectType:"StatementRef",id:t}}),0<c)for("function"==typeof r&&(a=function(t,e){var n;l.log("voidStatement - callbackWrapper: "+c),1<c?(--c,h.push({err:t,xhr:e})):1===c?(h.push({err:t,xhr:e}),n=[h,o],r.apply(this,n)):l.log("voidStatement - unexpected record store count: "+c)}),s=0;s<c;s+=1)n=this.recordStores[s],u.push(n.saveStatement(o,{callback:a}));else this.log("[warning] voidStatement: No LRSs added yet (statement not sent)"),"function"==typeof r&&r.apply(this,[null,o]);return{statement:o,results:u}},getVoidedStatement:function(t,e){if(this.log("getVoidedStatement"),0<this.recordStores.length)return this.recordStores[0].retrieveVoidedStatement(t,{callback:e});this.log("[warning] getVoidedStatement: No LRSs added yet (statement not retrieved)")},sendStatements:function(t,r){this.log("sendStatements");var e,n,i,o=this,s=[],a=this.recordStores.length,l=[],c=[];if(0===t.length)"function"==typeof r&&r.apply(this,[null,s]);else{for(n=0;n<t.length;n+=1)s.push(this.prepareStatement(t[n]));if(0<a)for("function"==typeof r&&(i=function(t,e){var n;o.log("sendStatements - callbackWrapper: "+a),1<a?(--a,c.push({err:t,xhr:e})):1===a?(c.push({err:t,xhr:e}),n=[c,s],r.apply(this,n)):o.log("sendStatements - unexpected record store count: "+a)}),n=0;n<a;n+=1)e=this.recordStores[n],l.push(e.saveStatements(s,{callback:i}));else this.log("[warning] sendStatements: No LRSs added yet (statements not sent)"),"function"==typeof r&&r.apply(this,[null,s])}return{statements:s,results:l}},getStatements:function(t){this.log("getStatements");var e,n,r={};if(0<this.recordStores.length)return e=this.recordStores[0],n=(t=t||{}).params||{},t.sendActor&&null!==this.actor&&("0.9"===e.version||"0.95"===e.version?n.actor=this.actor:n.agent=this.actor),t.sendActivity&&null!==this.activity&&("0.9"===e.version||"0.95"===e.version?n.target=this.activity:n.activity=this.activity),void 0===n.registration&&null!==this.registration&&(n.registration=this.registration),r={params:n},void 0!==t.callback&&(r.callback=t.callback),e.queryStatements(r);this.log("[warning] getStatements: No LRSs added yet (statements not read)")},getState:function(t,e){var n,r;if(this.log("getState"),0<this.recordStores.length)return r=this.recordStores[0],n={agent:void 0!==(e=e||{}).agent?e.agent:this.actor,activity:void 0!==e.activity?e.activity:this.activity},void 0!==e.registration?n.registration=e.registration:null!==this.registration&&(n.registration=this.registration),void 0!==e.callback&&(n.callback=e.callback),r.retrieveState(t,n);this.log("[warning] getState: No LRSs added yet (state not retrieved)")},setState:function(t,e,n){var r,i;if(this.log("setState"),0<this.recordStores.length)return i=this.recordStores[0],r={agent:void 0!==(n=n||{}).agent?n.agent:this.actor,activity:void 0!==n.activity?n.activity:this.activity},void 0!==n.registration?r.registration=n.registration:null!==this.registration&&(r.registration=this.registration),void 0!==n.lastSHA1&&(r.lastSHA1=n.lastSHA1),void 0!==n.contentType&&(r.contentType=n.contentType,void 0!==n.overwriteJSON&&!n.overwriteJSON&&TinCan.Utils.isApplicationJSON(n.contentType)&&(r.method="POST")),void 0!==n.callback&&(r.callback=n.callback),i.saveState(t,e,r);this.log("[warning] setState: No LRSs added yet (state not saved)")},deleteState:function(t,e){var n,r;if(this.log("deleteState"),0<this.recordStores.length)return r=this.recordStores[0],n={agent:void 0!==(e=e||{}).agent?e.agent:this.actor,activity:void 0!==e.activity?e.activity:this.activity},void 0!==e.registration?n.registration=e.registration:null!==this.registration&&(n.registration=this.registration),void 0!==e.callback&&(n.callback=e.callback),r.dropState(t,n);this.log("[warning] deleteState: No LRSs added yet (state not deleted)")},getActivityProfile:function(t,e){var n,r;if(this.log("getActivityProfile"),0<this.recordStores.length)return r=this.recordStores[0],n={activity:void 0!==(e=e||{}).activity?e.activity:this.activity},void 0!==e.callback&&(n.callback=e.callback),r.retrieveActivityProfile(t,n);this.log("[warning] getActivityProfile: No LRSs added yet (activity profile not retrieved)")},setActivityProfile:function(t,e,n){var r,i;if(this.log("setActivityProfile"),0<this.recordStores.length)return i=this.recordStores[0],r={activity:void 0!==(n=n||{}).activity?n.activity:this.activity},void 0!==n.callback&&(r.callback=n.callback),void 0!==n.lastSHA1&&(r.lastSHA1=n.lastSHA1),void 0!==n.contentType&&(r.contentType=n.contentType,void 0!==n.overwriteJSON&&!n.overwriteJSON&&TinCan.Utils.isApplicationJSON(n.contentType)&&(r.method="POST")),i.saveActivityProfile(t,e,r);this.log("[warning] setActivityProfile: No LRSs added yet (activity profile not saved)")},deleteActivityProfile:function(t,e){var n,r;if(this.log("deleteActivityProfile"),0<this.recordStores.length)return r=this.recordStores[0],n={activity:void 0!==(e=e||{}).activity?e.activity:this.activity},void 0!==e.callback&&(n.callback=e.callback),r.dropActivityProfile(t,n);this.log("[warning] deleteActivityProfile: No LRSs added yet (activity profile not deleted)")},getAgentProfile:function(t,e){var n,r;if(this.log("getAgentProfile"),0<this.recordStores.length)return r=this.recordStores[0],n={agent:void 0!==(e=e||{}).agent?e.agent:this.actor},void 0!==e.callback&&(n.callback=e.callback),r.retrieveAgentProfile(t,n);this.log("[warning] getAgentProfile: No LRSs added yet (agent profile not retrieved)")},setAgentProfile:function(t,e,n){var r,i;if(this.log("setAgentProfile"),0<this.recordStores.length)return i=this.recordStores[0],r={agent:void 0!==(n=n||{}).agent?n.agent:this.actor},void 0!==n.callback&&(r.callback=n.callback),void 0!==n.lastSHA1&&(r.lastSHA1=n.lastSHA1),void 0!==n.contentType&&(r.contentType=n.contentType,void 0!==n.overwriteJSON&&!n.overwriteJSON&&TinCan.Utils.isApplicationJSON(n.contentType)&&(r.method="POST")),i.saveAgentProfile(t,e,r);this.log("[warning] setAgentProfile: No LRSs added yet (agent profile not saved)")},deleteAgentProfile:function(t,e){var n,r;if(this.log("deleteAgentProfile"),0<this.recordStores.length)return r=this.recordStores[0],n={agent:void 0!==(e=e||{}).agent?e.agent:this.actor},void 0!==e.callback&&(n.callback=e.callback),r.dropAgentProfile(t,n);this.log("[warning] deleteAgentProfile: No LRSs added yet (agent profile not deleted)")}},TinCan.DEBUG=!1,TinCan.enableDebug=function(){TinCan.DEBUG=!0},TinCan.disableDebug=function(){TinCan.DEBUG=!1},TinCan.versions=function(){return["1.0.2","1.0.1","1.0.0","0.95","0.9"]},"object"==typeof module&&(module.exports=TinCan)}(),function(){"use strict";TinCan.Utils={defaultEncoding:"utf8",getUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},getISODateString:function(t){function e(t,e){var n,r;for(null==t&&(t=0),null==e&&(e=2),n=Math.pow(10,e-1),r=t.toString();t<n&&1<n;)r="0"+r,n/=10;return r}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"."+e(t.getUTCMilliseconds(),3)+"Z"},convertISO8601DurationToMilliseconds:function(t){var e,n,r,i,o=0<=t.indexOf("-"),s=t.indexOf("T"),a=t.indexOf("H"),l=t.indexOf("M"),c=t.indexOf("S");if(-1===s||-1!==l&&l<s||-1!==t.indexOf("D")||-1!==t.indexOf("Y"))throw new Error("ISO 8601 timestamps including years, months and/or days are not currently supported");return e=-1===a?(a=s,0):parseInt(t.slice(s+1,a),10),n=-1===l?(l=s,0):parseInt(t.slice(a+1,l),10),r=parseFloat(t.slice(l+1,c)),i=parseInt(1e3*(60*(60*e+n)+r),10),isNaN(i)&&(i=0),o&&(i*=-1),i},convertMillisecondsToISO8601Duration:function(t){var e,n,r=parseInt(t,10),i="",o="",s=Math.round(r/10);return s<0&&(i="-",s*=-1),o=i+"PT",0<(e=parseInt(s/36e4,10))&&(o+=e+"H"),0<(n=parseInt(s%36e4/6e3,10))&&(o+=n+"M"),o+=s%36e4%6e3/100+"S"},getSHA1String:function(t){return CryptoJS.SHA1(t).toString(CryptoJS.enc.Hex)},getSHA256String:function(t){return"[object ArrayBuffer]"===Object.prototype.toString.call(t)&&(t=CryptoJS.lib.WordArray.create(t)),CryptoJS.SHA256(t).toString(CryptoJS.enc.Hex)},getBase64String:function(t){return CryptoJS.enc.Base64.stringify(CryptoJS.enc.Latin1.parse(t))},getLangDictionaryValue:function(t,e){var n,r=this[t];if(void 0!==e&&void 0!==r[e])return r[e];if(void 0!==r.und)return r.und;if(void 0!==r["en-US"])return r["en-US"];for(n in r)if(r.hasOwnProperty(n))return r[n];return""},parseURL:function(t,e){function n(t){return decodeURIComponent(t.replace(c," "))}var r,i,o,s,a="/"===t.charAt(0),l=["(/[^?#]*)","(\\?[^#]*|)","(#.*|)$"],c=/\+/g,u=/([^&=]+)=?([^&]*)/g;if(e=e||{},a){if(void 0===e.allowRelative||!e.allowRelative)throw new Error("Refusing to parse relative URL without 'allowRelative' option")}else l.unshift("^(https?:)//","(([^:/?#]*)(?::([0-9]+))?)"),-1===t.indexOf("/",8)&&(t+="/");if(r=new RegExp(l.join("")),null===(i=t.match(r)))throw new Error("Unable to parse URL regular expression did not match: '"+t+"'");if(a?(o={protocol:null,host:null,hostname:null,port:null,path:null,pathname:i[1],search:i[2],hash:i[3],params:{}}).path=o.pathname:(o={protocol:i[1],host:i[2],hostname:i[3],port:i[4],pathname:i[5],search:i[6],hash:i[7],params:{}}).path=o.protocol+"//"+o.host+o.pathname,""!==o.search)for(;s=u.exec(o.search.substring(1));)o.params[n(s[1])]=n(s[2]);return o},getServerRoot:function(t){var e=t.split("/");return e[0]+"//"+e[2]},getContentTypeFromHeader:function(t){return String(t).split(";")[0]},isApplicationJSON:function(t){return 0===TinCan.Utils.getContentTypeFromHeader(t).toLowerCase().indexOf("application/json")},stringToArrayBuffer:function(){TinCan.prototype.log("stringToArrayBuffer not overloaded - no environment loaded?")},stringFromArrayBuffer:function(){TinCan.prototype.log("stringFromArrayBuffer not overloaded - no environment loaded?")}}}(),function(){"use strict";var t=TinCan.LRS=function(t){this.log("constructor"),this.endpoint=null,this.version=null,this.auth=null,this.allowFail=!0,this.extended=null,this.init(t)};t.prototype={LOG_SRC:"LRS",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=TinCan.versions(),r=!1;if((t=t||{}).hasOwnProperty("alertOnRequestFailure")&&this.log("'alertOnRequestFailure' is deprecated (alerts have been removed) no need to set it now"),!t.hasOwnProperty("endpoint")||null===t.endpoint||""===t.endpoint)throw this.log("[error] LRS invalid: no endpoint"),{code:3,mesg:"LRS invalid: no endpoint"};if(this.endpoint=String(t.endpoint),"/"!==this.endpoint.slice(-1)&&(this.log("adding trailing slash to endpoint"),this.endpoint+="/"),t.hasOwnProperty("allowFail")&&(this.allowFail=t.allowFail),t.hasOwnProperty("auth")?this.auth=t.auth:t.hasOwnProperty("username")&&t.hasOwnProperty("password")&&(this.auth="Basic "+TinCan.Utils.getBase64String(t.username+":"+t.password)),t.hasOwnProperty("extended")&&(this.extended=t.extended),this._initByEnvironment(t),void 0!==t.version){for(this.log("version: "+t.version),e=0;e<n.length;e+=1)if(n[e]===t.version){r=!0;break}if(!r)throw this.log("[error] LRS invalid: version not supported ("+t.version+")"),{code:5,mesg:"LRS invalid: version not supported ("+t.version+")"};this.version=t.version}else this.version=n[0]},_getBoundary:function(){return TinCan.Utils.getUUID().replace(/-/g,"")},_initByEnvironment:function(){this.log("_initByEnvironment not overloaded - no environment loaded?")},_makeRequest:function(){this.log("_makeRequest not overloaded - no environment loaded?")},_getMultipartRequestData:function(){this.log("_getMultipartRequestData not overloaded - no environment loaded?")},_IEModeConversion:function(){this.log("_IEModeConversion not overloaded - browser environment not loaded.")},_processGetStatementResult:function(t,e){var n,r,i,o,s={};if(!e.attachments)return TinCan.Statement.fromJSON(t.responseText);for(n=t.getResponseHeader("Content-Type").split("boundary=")[1],r=this._parseMultipart(n,t.response),i=JSON.parse(r[0].body),o=1;o<r.length;o+=1)s[r[o].headers["X-Experience-API-Hash"]]=r[o].body;return this._assignAttachmentContent([i],s),new TinCan.Statement(i)},sendRequest:function(t){this.log("sendRequest");var e,n=this.endpoint+t.url,r={};if(0===t.url.indexOf("http")&&(n=t.url),null!==this.extended)for(e in t.params=t.params||{},this.extended)this.extended.hasOwnProperty(e)&&(t.params.hasOwnProperty(e)||null!==this.extended[e]&&(t.params[e]=this.extended[e]));for(e in r.Authorization=this.auth,"0.9"!==this.version&&(r["X-Experience-API-Version"]=this.version),t.headers)t.headers.hasOwnProperty(e)&&(r[e]=t.headers[e]);return this._makeRequest(n,r,t)},about:function(r){var t,e,n;if(this.log("about"),t={url:"about",method:"GET",params:{}},void 0!==(r=r||{}).callback&&(n=function(t,e){var n=e;null===t&&(n=TinCan.About.fromJSON(e.responseText)),r.callback(t,n)},t.callback=n),e=this.sendRequest(t),!n)return null===e.err&&(e.xhr=TinCan.About.fromJSON(e.xhr.responseText)),e},saveStatement:function(t,e){this.log("saveStatement");var n,r,i,o={url:"statements",headers:{}},s=[];e=e||{};try{n=t.asVersion(this.version)}catch(t){return this.allowFail?(this.log("[warning] statement could not be serialized in version ("+this.version+"): "+t),void 0!==e.callback?void e.callback(null,null):{err:null,xhr:null}):(this.log("[error] statement could not be serialized in version ("+this.version+"): "+t),void 0!==e.callback?void e.callback(t,null):{err:t,xhr:null})}if(n.hasOwnProperty("attachments")&&t.hasAttachmentWithContent()){for(r=this._getBoundary(),o.headers["Content-Type"]="multipart/mixed; boundary="+r,i=0;i<t.attachments.length;i+=1)null!==t.attachments[i].content&&s.push(t.attachments[i]);try{o.data=this._getMultipartRequestData(r,n,s)}catch(t){return this.allowFail?(this.log("[warning] multipart request data could not be created (attachments probably not supported): "+t),void 0!==e.callback?void e.callback(null,null):{err:null,xhr:null}):(this.log("[error] multipart request data could not be created (attachments probably not supported): "+t),void 0!==e.callback?void e.callback(t,null):{err:t,xhr:null})}}else o.headers["Content-Type"]="application/json",o.data=JSON.stringify(n);return null!==t.id?(o.method="PUT",o.params={statementId:t.id}):o.method="POST",void 0!==e.callback&&(o.callback=e.callback),this.sendRequest(o)},retrieveStatement:function(t,r){this.log("retrieveStatement");var e,n,i,o=this;return(r=r||{}).params=r.params||{},e={url:"statements",method:"GET",params:{statementId:t}},r.params.attachments&&(e.params.attachments=!0,e.expectMultipart=!0),void 0!==r.callback&&(i=function(t,e){var n=e;null===t&&(n=o._processGetStatementResult(e,r.params)),r.callback(t,n)},e.callback=i),n=this.sendRequest(e),i||(n.statement=null)===n.err&&(n.statement=o._processGetStatementResult(n.xhr,r.params)),n},retrieveVoidedStatement:function(t,r){this.log("retrieveVoidedStatement");var e,n,i,o=this;return(r=r||{}).params=r.params||{},e={url:"statements",method:"GET",params:{}},"0.9"===this.version||"0.95"===this.version?e.params.statementId=t:(e.params.voidedStatementId=t,r.params.attachments&&(e.params.attachments=!0,e.expectMultipart=!0)),void 0!==r.callback&&(i=function(t,e){var n=e;null===t&&(n=o._processGetStatementResult(e,r.params)),r.callback(t,n)},e.callback=i),n=this.sendRequest(e),i||(n.statement=null)===n.err&&(n.statement=o._processGetStatementResult(n.xhr,r.params)),n},saveStatements:function(t,e){this.log("saveStatements");var n,r,i,o,s={url:"statements",method:"POST",headers:{}},a=[],l=[];if(e=e||{},0===t.length)return void 0!==e.callback?void e.callback(new Error("no statements"),null):{err:new Error("no statements"),xhr:null};for(i=0;i<t.length;i+=1){try{n=t[i].asVersion(this.version)}catch(t){return this.allowFail?(this.log("[warning] statement could not be serialized in version ("+this.version+"): "+t),void 0!==e.callback?void e.callback(null,null):{err:null,xhr:null}):(this.log("[error] statement could not be serialized in version ("+this.version+"): "+t),void 0!==e.callback?void e.callback(t,null):{err:t,xhr:null})}if(t[i].hasAttachmentWithContent())for(o=0;o<t[i].attachments.length;o+=1)null!==t[i].attachments[o].content&&l.push(t[i].attachments[o]);a.push(n)}if(0!==l.length){r=this._getBoundary(),s.headers["Content-Type"]="multipart/mixed; boundary="+r;try{s.data=this._getMultipartRequestData(r,a,l)}catch(t){return this.allowFail?(this.log("[warning] multipart request data could not be created (attachments probably not supported): "+t),void 0!==e.callback?void e.callback(null,null):{err:null,xhr:null}):(this.log("[error] multipart request data could not be created (attachments probably not supported): "+t),void 0!==e.callback?void e.callback(t,null):{err:t,xhr:null})}}else s.headers["Content-Type"]="application/json",s.data=JSON.stringify(a);return void 0!==e.callback&&(s.callback=e.callback),this.sendRequest(s)},queryStatements:function(l){this.log("queryStatements");var t,e,n,c=this;(l=l||{}).params=l.params||{};try{t=this._queryStatementsRequestCfg(l),l.params.attachments&&(t.expectMultipart=!0)}catch(t){return this.log("[error] Query statements failed - "+t),void 0!==l.callback&&l.callback(t,{}),{err:t,statementsResult:null}}return void 0!==l.callback&&(n=function(t,e){var n,r,i,o,s=e,a={};if(null===t)if(l.params.attachments){for(r=e.getResponseHeader("Content-Type").split("boundary=")[1],n=c._parseMultipart(r,e.response),i=JSON.parse(n[0].body),o=1;o<n.length;o+=1)a[n[o].headers["X-Experience-API-Hash"]]=n[o].body;for(c._assignAttachmentContent(i.statements,a),s=new TinCan.StatementsResult({statements:i.statements}),o=0;o<s.statements.length;o+=1)s.statements[o]instanceof TinCan.Statement||(s.statements[o]=new TinCan.Statement(s.statements[o]))}else s=TinCan.StatementsResult.fromJSON(e.responseText);l.callback(t,s)},t.callback=n),(e=this.sendRequest(t)).config=t,n||(e.statementsResult=null)===e.err&&(e.statementsResult=TinCan.StatementsResult.fromJSON(e.xhr.responseText)),e},_queryStatementsRequestCfg:function(t){this.log("_queryStatementsRequestCfg");var e,n,r={},i={url:"statements",method:"GET",params:r},o=["agent","actor","object","instructor"],s=["verb","activity"],a=["registration","context","since","until","limit","authoritative","sparse","ascending","related_activities","related_agents","format","attachments"],l={verb:!0,registration:!0,since:!0,until:!0,limit:!0,ascending:!0},c={.9:{supported:{actor:!0,instructor:!0,target:!0,object:!0,context:!0,authoritative:!0,sparse:!0}},"1.0.0":{supported:{agent:!0,activity:!0,related_activities:!0,related_agents:!0,format:!0,attachments:!0}}};for(n in c[.95]=c[.9],c["1.0.1"]=c["1.0.0"],c["1.0.2"]=c["1.0.0"],t.params.hasOwnProperty("target")&&(t.params.object=t.params.target),t.params)if(t.params.hasOwnProperty(n)&&void 0===l[n]&&void 0===c[this.version].supported[n])throw"Unrecognized query parameter configured: "+n;for(e=0;e<o.length;e+=1)void 0!==t.params[o[e]]&&(r[o[e]]=JSON.stringify(t.params[o[e]].asVersion(this.version)));for(e=0;e<s.length;e+=1)void 0!==t.params[s[e]]&&(void 0===t.params[s[e]].id?r[s[e]]=t.params[s[e]]:r[s[e]]=t.params[s[e]].id);for(e=0;e<a.length;e+=1)void 0!==t.params[a[e]]&&null!==t.params[a[e]]&&(r[a[e]]=t.params[a[e]]);return i},_assignAttachmentContent:function(t,e){for(var n,r=0;r<t.length;r+=1)if(t[r].hasOwnProperty("attachments")&&null!==t[r].attachments)for(n=0;n<t[r].attachments.length;n+=1)e.hasOwnProperty(t[r].attachments[n].sha2)&&(t[r].attachments[n].content=e[t[r].attachments[n].sha2])},_parseMultipart:function(t,e){for(var n,r,i,o,s,a,l,c="--"+t,u=[],h=new Uint8Array(e),p=this.__uint8ToString(h),f=p.indexOf(c+"--"),d=p.indexOf(c);-1!==d;)n=p.indexOf(c,d+c.length),r=d+c.length+2,o=(i=p.indexOf("\r\n\r\n",d))+2+2,s=n-2,a=this._parseHeaders(this.__uint8ToString(new Uint8Array(e.slice(r,i)))),l=e.slice(o,s),0===u.length&&(l=TinCan.Utils.stringFromArrayBuffer(l)),u.push({headers:a,body:l}),d=n===f?-1:n;return u},__uint8ToString:function(t){for(var e="",n=t.byteLength,r=0;r<n;r+=1)e+=String.fromCharCode(t[r]);return e},_parseHeaders:function(t){for(var e,n={},r=t.split("\n"),i=0;i<r.length;i+=1)null!==(e=r[i].split(":",2))[1]?(n[e[0]]=e[1].replace(/^\s+|\s+$/g,""),e[0]):"\t"===e[0].substring(0,1)&&(n[e[0]]=e[1].replace(/^\s+|\s+$/g,""));return n},moreStatements:function(r){var t,e,n,i,o;return this.log("moreStatements: "+r.url),r=r||{},i=TinCan.Utils.parseURL(r.url,{allowRelative:!0}),o=TinCan.Utils.getServerRoot(this.endpoint),0===i.path.indexOf("/statements")&&(i.path=this.endpoint.replace(o,"")+i.path,this.log("converting non-standard more URL to "+i.path)),0!==i.path.indexOf("/")&&(i.path="/"+i.path),t={method:"GET",url:o+i.path,params:i.params},void 0!==r.callback&&(n=function(t,e){var n=e;null===t&&(n=TinCan.StatementsResult.fromJSON(e.responseText)),r.callback(t,n)},t.callback=n),(e=this.sendRequest(t)).config=t,n||(e.statementsResult=null)===e.err&&(e.statementsResult=TinCan.StatementsResult.fromJSON(e.xhr.responseText)),e},retrieveState:function(r,i){this.log("retrieveState");var t,e,n={},o={},s=this,a=i.requestHeaders||{},n={stateId:r,activityId:i.activity.id};if("0.9"===this.version?n.actor=JSON.stringify(i.agent.asVersion(this.version)):n.agent=JSON.stringify(i.agent.asVersion(this.version)),void 0!==i.registration&&null!==i.registration&&("0.9"===this.version?n.registrationId=i.registration:n.registration=i.registration),o={url:"activities/state",method:"GET",params:n,ignore404:!0,headers:a},void 0!==i.callback&&(e=function(t,e){var n=e;if(null===t)if(404===e.status)n=null;else if(n=new TinCan.State({id:r,contents:e.responseText}),void 0!==e.getResponseHeader&&null!==e.getResponseHeader("ETag")&&""!==e.getResponseHeader("ETag")?n.etag=e.getResponseHeader("ETag"):n.etag='"'+TinCan.Utils.getSHA1String(e.responseText)+'"',void 0!==e.contentType?n.contentType=e.contentType:void 0!==e.getResponseHeader&&null!==e.getResponseHeader("Content-Type")&&""!==e.getResponseHeader("Content-Type")&&(n.contentType=e.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(n.contentType))try{n.contents=JSON.parse(n.contents)}catch(t){s.log("retrieveState - failed to deserialize JSON: "+t)}i.callback(t,n)},o.callback=e),t=this.sendRequest(o),!e&&(t.state=null)===t.err&&404!==t.xhr.status&&(t.state=new TinCan.State({id:r,contents:t.xhr.responseText}),void 0!==t.xhr.getResponseHeader&&null!==t.xhr.getResponseHeader("ETag")&&""!==t.xhr.getResponseHeader("ETag")?t.state.etag=t.xhr.getResponseHeader("ETag"):t.state.etag='"'+TinCan.Utils.getSHA1String(t.xhr.responseText)+'"',void 0!==t.xhr.contentType?t.state.contentType=t.xhr.contentType:void 0!==t.xhr.getResponseHeader&&null!==t.xhr.getResponseHeader("Content-Type")&&""!==t.xhr.getResponseHeader("Content-Type")&&(t.state.contentType=t.xhr.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(t.state.contentType)))try{t.state.contents=JSON.parse(t.state.contents)}catch(t){this.log("retrieveState - failed to deserialize JSON: "+t)}return t},retrieveStateIds:function(r){this.log("retrieveStateIds");var t,e,n,i={},o=(r=r||{}).requestHeaders||{};if(i.activityId=r.activity.id,"0.9"===this.version?i.actor=JSON.stringify(r.agent.asVersion(this.version)):i.agent=JSON.stringify(r.agent.asVersion(this.version)),void 0!==r.registration&&null!==r.registration&&("0.9"===this.version?i.registrationId=r.registration:i.registration=r.registration),t={url:"activities/state",method:"GET",params:i,headers:o,ignore404:!0},void 0!==r.callback&&(n=function(e,t){var n=t;if(null===e){if(404===t.status)n=[];else try{n=JSON.parse(t.responseText)}catch(t){e="Response JSON parse error: "+t}r.callback(e,n)}else r.callback(e,n)},t.callback=n),void 0!==r.since&&(t.params.since=r.since),e=this.sendRequest(t),!n){if((e.profileIds=null)!==e.err)return e;if(404===e.xhr.status)e.profileIds=[];else try{e.profileIds=JSON.parse(e.xhr.responseText)}catch(t){e.err="retrieveStateIds - JSON parse error: "+t}}return e},saveState:function(t,e,n){var r,i,o;return this.log("saveState"),o=n.requestHeaders||{},void 0===n.contentType&&(n.contentType="application/octet-stream"),o["Content-Type"]=n.contentType,"object"==typeof e&&TinCan.Utils.isApplicationJSON(n.contentType)&&(e=JSON.stringify(e)),void 0!==n.method&&"POST"===n.method||(n.method="PUT"),r={stateId:t,activityId:n.activity.id},"0.9"===this.version?r.actor=JSON.stringify(n.agent.asVersion(this.version)):r.agent=JSON.stringify(n.agent.asVersion(this.version)),void 0!==n.registration&&null!==n.registration&&("0.9"===this.version?r.registrationId=n.registration:r.registration=n.registration),i={url:"activities/state",method:n.method,params:r,data:e,headers:o},void 0!==n.callback&&(i.callback=n.callback),void 0!==n.lastSHA1&&null!==n.lastSHA1&&(i.headers["If-Match"]=n.lastSHA1),this.sendRequest(i)},dropState:function(t,e){var n,r,i;return this.log("dropState"),i=e.requestHeaders||{},n={activityId:e.activity.id},"0.9"===this.version?n.actor=JSON.stringify(e.agent.asVersion(this.version)):n.agent=JSON.stringify(e.agent.asVersion(this.version)),null!==t&&(n.stateId=t),void 0!==e.registration&&null!==e.registration&&("0.9"===this.version?n.registrationId=e.registration:n.registration=e.registration),r={url:"activities/state",method:"DELETE",params:n,headers:i},void 0!==e.callback&&(r.callback=e.callback),this.sendRequest(r)},retrieveActivity:function(r,i){this.log("retrieveActivity");var t,e,n={},o=i.requestHeaders||{},n={url:"activities",method:"GET",params:{activityId:r},ignore404:!0,headers:o};return void 0!==i.callback&&(e=function(t,e){var n=e;null===t&&(n=404===e.status?new TinCan.Activity({id:r}):TinCan.Activity.fromJSON(e.responseText)),i.callback(t,n)},n.callback=e),t=this.sendRequest(n),e||(t.activity=null)===t.err&&(404===t.xhr.status?t.activity=new TinCan.Activity({id:r}):t.activity=TinCan.Activity.fromJSON(t.xhr.responseText)),t},retrieveActivityProfile:function(r,i){this.log("retrieveActivityProfile");var t,e,n={},o=this,s=i.requestHeaders||{},n={url:"activities/profile",method:"GET",params:{profileId:r,activityId:i.activity.id},ignore404:!0,headers:s};if(void 0!==i.callback&&(e=function(t,e){var n=e;if(null===t)if(404===e.status)n=null;else if(n=new TinCan.ActivityProfile({id:r,activity:i.activity,contents:e.responseText}),void 0!==e.getResponseHeader&&null!==e.getResponseHeader("ETag")&&""!==e.getResponseHeader("ETag")?n.etag=e.getResponseHeader("ETag"):n.etag='"'+TinCan.Utils.getSHA1String(e.responseText)+'"',void 0!==e.contentType?n.contentType=e.contentType:void 0!==e.getResponseHeader&&null!==e.getResponseHeader("Content-Type")&&""!==e.getResponseHeader("Content-Type")&&(n.contentType=e.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(n.contentType))try{n.contents=JSON.parse(n.contents)}catch(t){o.log("retrieveActivityProfile - failed to deserialize JSON: "+t)}i.callback(t,n)},n.callback=e),t=this.sendRequest(n),!e&&(t.profile=null)===t.err&&404!==t.xhr.status&&(t.profile=new TinCan.ActivityProfile({id:r,activity:i.activity,contents:t.xhr.responseText}),void 0!==t.xhr.getResponseHeader&&null!==t.xhr.getResponseHeader("ETag")&&""!==t.xhr.getResponseHeader("ETag")?t.profile.etag=t.xhr.getResponseHeader("ETag"):t.profile.etag='"'+TinCan.Utils.getSHA1String(t.xhr.responseText)+'"',void 0!==t.xhr.contentType?t.profile.contentType=t.xhr.contentType:void 0!==t.xhr.getResponseHeader&&null!==t.xhr.getResponseHeader("Content-Type")&&""!==t.xhr.getResponseHeader("Content-Type")&&(t.profile.contentType=t.xhr.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(t.profile.contentType)))try{t.profile.contents=JSON.parse(t.profile.contents)}catch(t){this.log("retrieveActivityProfile - failed to deserialize JSON: "+t)}return t},retrieveActivityProfileIds:function(r){var t,e,n,i;if(this.log("retrieveActivityProfileIds"),e=(r=r||{}).requestHeaders||{},t={url:"activities/profile",method:"GET",params:{activityId:r.activity.id},headers:e,ignore404:!0},void 0!==r.callback&&(i=function(e,t){var n=t;if(null===e){if(404===t.status)n=[];else try{n=JSON.parse(t.responseText)}catch(t){e="Response JSON parse error: "+t}r.callback(e,n)}else r.callback(e,n)},t.callback=i),void 0!==r.since&&(t.params.since=r.since),n=this.sendRequest(t),!i){if((n.profileIds=null)!==n.err)return n;if(404===n.xhr.status)n.profileIds=[];else try{n.profileIds=JSON.parse(n.xhr.responseText)}catch(t){n.err="retrieveActivityProfileIds - JSON parse error: "+t}}return n},saveActivityProfile:function(t,e,n){var r,i;return this.log("saveActivityProfile"),i=n.requestHeaders||{},void 0===n.contentType&&(n.contentType="application/octet-stream"),i["Content-Type"]=n.contentType,void 0!==n.method&&"POST"===n.method||(n.method="PUT"),"object"==typeof e&&TinCan.Utils.isApplicationJSON(n.contentType)&&(e=JSON.stringify(e)),r={url:"activities/profile",method:n.method,params:{profileId:t,activityId:n.activity.id},data:e,headers:i},void 0!==n.callback&&(r.callback=n.callback),void 0!==n.lastSHA1&&null!==n.lastSHA1?r.headers["If-Match"]=n.lastSHA1:r.headers["If-None-Match"]="*",this.sendRequest(r)},dropActivityProfile:function(t,e){var n,r;return this.log("dropActivityProfile"),r=e.requestHeaders||{},n={url:"activities/profile",method:"DELETE",params:{profileId:t,activityId:e.activity.id},headers:r},void 0!==e.callback&&(n.callback=e.callback),this.sendRequest(n)},retrieveAgentProfile:function(r,i){this.log("retrieveAgentProfile");var t,e,n={},o=this,s=i.requestHeaders||{},n={method:"GET",params:{profileId:r},ignore404:!0,headers:s};if("0.9"===this.version?(n.url="actors/profile",n.params.actor=JSON.stringify(i.agent.asVersion(this.version))):(n.url="agents/profile",n.params.agent=JSON.stringify(i.agent.asVersion(this.version))),void 0!==i.callback&&(e=function(t,e){var n=e;if(null===t)if(404===e.status)n=null;else if(n=new TinCan.AgentProfile({id:r,agent:i.agent,contents:e.responseText}),void 0!==e.getResponseHeader&&null!==e.getResponseHeader("ETag")&&""!==e.getResponseHeader("ETag")?n.etag=e.getResponseHeader("ETag"):n.etag='"'+TinCan.Utils.getSHA1String(e.responseText)+'"',void 0!==e.contentType?n.contentType=e.contentType:void 0!==e.getResponseHeader&&null!==e.getResponseHeader("Content-Type")&&""!==e.getResponseHeader("Content-Type")&&(n.contentType=e.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(n.contentType))try{n.contents=JSON.parse(n.contents)}catch(t){o.log("retrieveAgentProfile - failed to deserialize JSON: "+t)}i.callback(t,n)},n.callback=e),t=this.sendRequest(n),!e&&(t.profile=null)===t.err&&404!==t.xhr.status&&(t.profile=new TinCan.AgentProfile({id:r,agent:i.agent,contents:t.xhr.responseText}),void 0!==t.xhr.getResponseHeader&&null!==t.xhr.getResponseHeader("ETag")&&""!==t.xhr.getResponseHeader("ETag")?t.profile.etag=t.xhr.getResponseHeader("ETag"):t.profile.etag='"'+TinCan.Utils.getSHA1String(t.xhr.responseText)+'"',void 0!==t.xhr.contentType?t.profile.contentType=t.xhr.contentType:void 0!==t.xhr.getResponseHeader&&null!==t.xhr.getResponseHeader("Content-Type")&&""!==t.xhr.getResponseHeader("Content-Type")&&(t.profile.contentType=t.xhr.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(t.profile.contentType)))try{t.profile.contents=JSON.parse(t.profile.contents)}catch(t){this.log("retrieveAgentProfile - failed to deserialize JSON: "+t)}return t},retrieveAgentProfileIds:function(r){this.log("retrieveAgentProfileIds");var e,t,n={},i={method:"GET",params:n,headers:(r=r||{}).requestHeaders||{},ignore404:!0};if("0.9"===this.version?(i.url="actors/profile",n.actor=JSON.stringify(r.agent.asVersion(this.version))):(i.url="agents/profile",n.agent=JSON.stringify(r.agent.asVersion(this.version))),void 0!==r.callback&&(t=function(e,t){var n=t;if(null===e){if(404===t.status)n=[];else try{n=JSON.parse(t.responseText)}catch(t){e="Response JSON parse error: "+t}r.callback(e,n)}else r.callback(e,n)},i.callback=t),void 0!==r.since&&(i.params.since=r.since),e=this.sendRequest(i),!t){if((e.profileIds=null)!==e.err)return e;if(404===e.xhr.status)e.profileIds=[];else try{e.profileIds=JSON.parse(e.xhr.responseText)}catch(t){e.err="retrieveAgentProfileIds - JSON parse error: "+t}}return e},saveAgentProfile:function(t,e,n){var r,i;return this.log("saveAgentProfile"),i=n.requestHeaders||{},void 0===n.contentType&&(n.contentType="application/octet-stream"),i["Content-Type"]=n.contentType,void 0!==n.method&&"POST"===n.method||(n.method="PUT"),"object"==typeof e&&TinCan.Utils.isApplicationJSON(n.contentType)&&(e=JSON.stringify(e)),r={method:n.method,params:{profileId:t},data:e,headers:i},"0.9"===this.version?(r.url="actors/profile",r.params.actor=JSON.stringify(n.agent.asVersion(this.version))):(r.url="agents/profile",r.params.agent=JSON.stringify(n.agent.asVersion(this.version))),void 0!==n.callback&&(r.callback=n.callback),void 0!==n.lastSHA1&&null!==n.lastSHA1?r.headers["If-Match"]=n.lastSHA1:r.headers["If-None-Match"]="*",this.sendRequest(r)},dropAgentProfile:function(t,e){var n,r;return this.log("dropAgentProfile"),r={method:"DELETE",params:n={profileId:t},headers:e.requestHeaders||{}},"0.9"===this.version?(r.url="actors/profile",n.actor=JSON.stringify(e.agent.asVersion(this.version))):(r.url="agents/profile",n.agent=JSON.stringify(e.agent.asVersion(this.version))),void 0!==e.callback&&(r.callback=e.callback),this.sendRequest(r)}},t.syncEnabled=null}(),function(){"use strict";var n=TinCan.AgentAccount=function(t){this.log("constructor"),this.homePage=null,this.name=null,this.init(t)};n.prototype={LOG_SRC:"AgentAccount",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["name","homePage"];for(void 0!==(t=t||{}).accountServiceHomePage&&(t.homePage=t.accountServiceHomePage),void 0!==t.accountName&&(t.name=t.accountName),e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]])},toString:function(){this.log("toString");var t="";return null!==this.name||null!==this.homePage?(t+=null!==this.name?this.name:"-",t+=":",t+=null!==this.homePage?this.homePage:"-"):t="AgentAccount: unidentified",t},asVersion:function(t){this.log("asVersion: "+t);var e={};return"0.9"===(t=t||TinCan.versions()[0])?(e.accountName=this.name,e.accountServiceHomePage=this.homePage):(e.name=this.name,e.homePage=this.homePage),e}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.Agent=function(t){this.log("constructor"),this.name=null,this.mbox=null,this.mbox_sha1sum=null,this.openid=null,this.account=null,this.degraded=!1,this.init(t)};n.prototype={objectType:"Agent",LOG_SRC:"Agent",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n,r=["name","mbox","mbox_sha1sum","openid"];for(void 0!==(t=t||{}).lastName||void 0!==t.firstName?(t.name="",void 0!==t.firstName&&0<t.firstName.length&&(t.name=t.firstName[0],1<t.firstName.length&&(this.degraded=!0)),""!==t.name&&(t.name+=" "),void 0!==t.lastName&&0<t.lastName.length&&(t.name+=t.lastName[0],1<t.lastName.length&&(this.degraded=!0))):void 0===t.familyName&&void 0===t.givenName||(t.name="",void 0!==t.givenName&&0<t.givenName.length&&(t.name=t.givenName[0],1<t.givenName.length&&(this.degraded=!0)),""!==t.name&&(t.name+=" "),void 0!==t.familyName&&0<t.familyName.length&&(t.name+=t.familyName[0],1<t.familyName.length&&(this.degraded=!0))),"object"==typeof t.name&&null!==t.name&&(1<t.name.length&&(this.degraded=!0),t.name=t.name[0]),"object"==typeof t.mbox&&null!==t.mbox&&(1<t.mbox.length&&(this.degraded=!0),t.mbox=t.mbox[0]),"object"==typeof t.mbox_sha1sum&&null!==t.mbox_sha1sum&&(1<t.mbox_sha1sum.length&&(this.degraded=!0),t.mbox_sha1sum=t.mbox_sha1sum[0]),"object"==typeof t.openid&&null!==t.openid&&(1<t.openid.length&&(this.degraded=!0),t.openid=t.openid[0]),"object"==typeof t.account&&null!==t.account&&void 0===t.account.homePage&&void 0===t.account.name&&(0===t.account.length?delete t.account:(1<t.account.length&&(this.degraded=!0),t.account=t.account[0])),t.hasOwnProperty("account")&&(t.account instanceof TinCan.AgentAccount?this.account=t.account:this.account=new TinCan.AgentAccount(t.account)),e=0;e<r.length;e+=1)t.hasOwnProperty(r[e])&&null!==t[r[e]]&&(n=t[r[e]],"mbox"===r[e]&&-1===n.indexOf("mailto:")&&(n="mailto:"+n),this[r[e]]=n)},toString:function(){return this.log("toString"),null!==this.name?this.name:null!==this.mbox?this.mbox.replace("mailto:",""):null!==this.mbox_sha1sum?this.mbox_sha1sum:null!==this.openid?this.openid:null!==this.account?this.account.toString():this.objectType+": unidentified"},asVersion:function(t){this.log("asVersion: "+t);var e={objectType:this.objectType};return"0.9"===(t=t||TinCan.versions()[0])?(null!==this.mbox?e.mbox=[this.mbox]:null!==this.mbox_sha1sum?e.mbox_sha1sum=[this.mbox_sha1sum]:null!==this.openid?e.openid=[this.openid]:null!==this.account&&(e.account=[this.account.asVersion(t)]),null!==this.name&&(e.name=[this.name])):(null!==this.mbox?e.mbox=this.mbox:null!==this.mbox_sha1sum?e.mbox_sha1sum=this.mbox_sha1sum:null!==this.openid?e.openid=this.openid:null!==this.account&&(e.account=this.account.asVersion(t)),null!==this.name&&(e.name=this.name)),e}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.Group=function(t){this.log("constructor"),this.name=null,this.mbox=null,this.mbox_sha1sum=null,this.openid=null,this.account=null,this.member=[],this.init(t)};n.prototype={objectType:"Group",LOG_SRC:"Group",log:TinCan.prototype.log,init:function(t){var e;if(this.log("init"),t=t||{},TinCan.Agent.prototype.init.call(this,t),void 0!==t.member)for(e=0;e<t.member.length;e+=1)t.member[e]instanceof TinCan.Agent?this.member.push(t.member[e]):this.member.push(new TinCan.Agent(t.member[e]))},toString:function(t){this.log("toString");var e=TinCan.Agent.prototype.toString.call(this,t);return e!==this.objectType+": unidentified"&&(e=this.objectType+": "+e),e},asVersion:function(t){var e,n;if(this.log("asVersion: "+t),t=t||TinCan.versions()[0],e=TinCan.Agent.prototype.asVersion.call(this,t),0<this.member.length)for(e.member=[],n=0;n<this.member.length;n+=1)e.member.push(this.member[n].asVersion(t));return e}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var i={"http://adlnet.gov/expapi/verbs/experienced":"experienced","http://adlnet.gov/expapi/verbs/attended":"attended","http://adlnet.gov/expapi/verbs/attempted":"attempted","http://adlnet.gov/expapi/verbs/completed":"completed","http://adlnet.gov/expapi/verbs/passed":"passed","http://adlnet.gov/expapi/verbs/failed":"failed","http://adlnet.gov/expapi/verbs/answered":"answered","http://adlnet.gov/expapi/verbs/interacted":"interacted","http://adlnet.gov/expapi/verbs/imported":"imported","http://adlnet.gov/expapi/verbs/created":"created","http://adlnet.gov/expapi/verbs/shared":"shared","http://adlnet.gov/expapi/verbs/voided":"voided"},n=TinCan.Verb=function(t){this.log("constructor"),this.id=null,this.display=null,this.init(t)};n.prototype={LOG_SRC:"Verb",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n,r=["id","display"];if("string"==typeof t){for(n in this.id=t,this.display={und:this.id},i)if(i.hasOwnProperty(n)&&i[n]===t){this.id=n;break}}else{for(t=t||{},e=0;e<r.length;e+=1)t.hasOwnProperty(r[e])&&null!==t[r[e]]&&(this[r[e]]=t[r[e]]);null===this.display&&void 0!==i[this.id]&&(this.display={und:i[this.id]})}},toString:function(t){return this.log("toString"),null!==this.display?this.getLangDictionaryValue("display",t):this.id},asVersion:function(t){var e;return this.log("asVersion"),"0.9"===(t=t||TinCan.versions()[0])?e=i[this.id]:(e={id:this.id},null!==this.display&&(e.display=this.display)),e},getLangDictionaryValue:TinCan.Utils.getLangDictionaryValue},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.Result=function(t){this.log("constructor"),this.score=null,this.success=null,this.completion=null,this.duration=null,this.response=null,this.extensions=null,this.init(t)};n.prototype={LOG_SRC:"Result",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["completion","duration","extensions","response","success"];for((t=t||{}).hasOwnProperty("score")&&null!==t.score&&(t.score instanceof TinCan.Score?this.score=t.score:this.score=new TinCan.Score(t.score)),e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]]);"Completed"===this.completion&&(this.completion=!0)},asVersion:function(t){this.log("asVersion");var e,n={},r=["success","duration","response","extensions"],i=["score"];for(t=t||TinCan.versions()[0],e=0;e<r.length;e+=1)null!==this[r[e]]&&(n[r[e]]=this[r[e]]);for(e=0;e<i.length;e+=1)null!==this[i[e]]&&(n[i[e]]=this[i[e]].asVersion(t));return null!==this.completion&&("0.9"===t?this.completion&&(n.completion="Completed"):n.completion=this.completion),n}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.Score=function(t){this.log("constructor"),this.scaled=null,this.raw=null,this.min=null,this.max=null,this.init(t)};n.prototype={LOG_SRC:"Score",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["scaled","raw","min","max"];for(t=t||{},e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]])},asVersion:function(t){this.log("asVersion");var e,n={},r=["scaled","raw","min","max"];for(t=t||TinCan.versions()[0],e=0;e<r.length;e+=1)null!==this[r[e]]&&(n[r[e]]=this[r[e]]);return n}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.InteractionComponent=function(t){this.log("constructor"),this.id=null,this.description=null,this.init(t)};n.prototype={LOG_SRC:"InteractionComponent",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["id","description"];for(t=t||{},e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]])},asVersion:function(t){this.log("asVersion");var e,n,r={id:this.id},i=["description"];for(t=t||TinCan.versions()[0],e=0;e<i.length;e+=1)null!==this[n=i[e]]&&(r[n]=this[n]);return r},getLangDictionaryValue:TinCan.Utils.getLangDictionaryValue},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var a={"http://adlnet.gov/expapi/activities/course":"course","http://adlnet.gov/expapi/activities/module":"module","http://adlnet.gov/expapi/activities/meeting":"meeting","http://adlnet.gov/expapi/activities/media":"media","http://adlnet.gov/expapi/activities/performance":"performance","http://adlnet.gov/expapi/activities/simulation":"simulation","http://adlnet.gov/expapi/activities/assessment":"assessment","http://adlnet.gov/expapi/activities/interaction":"interaction","http://adlnet.gov/expapi/activities/cmi.interaction":"cmi.interaction","http://adlnet.gov/expapi/activities/question":"question","http://adlnet.gov/expapi/activities/objective":"objective","http://adlnet.gov/expapi/activities/link":"link"},n=TinCan.ActivityDefinition=function(t){this.log("constructor"),this.name=null,this.description=null,this.type=null,this.moreInfo=null,this.extensions=null,this.interactionType=null,this.correctResponsesPattern=null,this.choices=null,this.scale=null,this.source=null,this.target=null,this.steps=null,this.init(t)};n.prototype={LOG_SRC:"ActivityDefinition",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n,r,i=["name","description","moreInfo","extensions","correctResponsesPattern"],o=[];if((t=t||{}).hasOwnProperty("type")&&null!==t.type){for(r in a)a.hasOwnProperty(r)&&a[r]===t.type&&(t.type=a[r]);this.type=t.type}if(t.hasOwnProperty("interactionType")&&null!==t.interactionType&&(this.interactionType=t.interactionType,"choice"===t.interactionType||"sequencing"===t.interactionType?o.push("choices"):"likert"===t.interactionType?o.push("scale"):"matching"===t.interactionType?(o.push("source"),o.push("target")):"performance"===t.interactionType&&o.push("steps"),0<o.length))for(e=0;e<o.length;e+=1)if(r=o[e],t.hasOwnProperty(r)&&null!==t[r])for(this[r]=[],n=0;n<t[r].length;n+=1)t[r][n]instanceof TinCan.InteractionComponent?this[r].push(t[r][n]):this[r].push(new TinCan.InteractionComponent(t[r][n]));for(e=0;e<i.length;e+=1)t.hasOwnProperty(i[e])&&null!==t[i[e]]&&(this[i[e]]=t[i[e]])},toString:function(t){return this.log("toString"),null!==this.name?this.getLangDictionaryValue("name",t):null!==this.description?this.getLangDictionaryValue("description",t):""},asVersion:function(t){this.log("asVersion");var e,n,r,i={},o=["name","description","interactionType","correctResponsesPattern","extensions"],s=["choices","scale","source","target","steps"];for(t=t||TinCan.versions()[0],null!==this.type&&(i.type="0.9"===t?a[this.type]:this.type),e=0;e<o.length;e+=1)null!==this[r=o[e]]&&(i[r]=this[r]);for(e=0;e<s.length;e+=1)if(null!==this[r=s[e]])for(i[r]=[],n=0;n<this[r].length;n+=1)i[r].push(this[r][n].asVersion(t));return 0!==t.indexOf("0.9")&&null!==this.moreInfo&&(i.moreInfo=this.moreInfo),i},getLangDictionaryValue:TinCan.Utils.getLangDictionaryValue},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.Activity=function(t){this.log("constructor"),this.objectType="Activity",this.id=null,this.definition=null,this.init(t)};n.prototype={LOG_SRC:"Activity",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["id"];for((t=t||{}).hasOwnProperty("definition")&&(t.definition instanceof TinCan.ActivityDefinition?this.definition=t.definition:this.definition=new TinCan.ActivityDefinition(t.definition)),e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]])},toString:function(t){this.log("toString");var e;return null!==this.definition&&""!==(e=this.definition.toString(t))?e:null!==this.id?this.id:"Activity: unidentified"},asVersion:function(t){this.log("asVersion");var e={id:this.id,objectType:this.objectType};return t=t||TinCan.versions()[0],null!==this.definition&&(e.definition=this.definition.asVersion(t)),e}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.ContextActivities=function(t){this.log("constructor"),this.category=null,this.parent=null,this.grouping=null,this.other=null,this.init(t)};n.prototype={LOG_SRC:"ContextActivities",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n,r,i,o=["category","parent","grouping","other"];for(t=t||{},e=0;e<o.length;e+=1)if(r=o[e],t.hasOwnProperty(r)&&null!==t[r])if("[object Array]"===Object.prototype.toString.call(t[r]))for(n=0;n<t[r].length;n+=1)this.add(r,t[r][n]);else i=t[r],this.add(r,i)},add:function(t,e){if("category"===t||"parent"===t||"grouping"===t||"other"===t)return null===this[t]&&(this[t]=[]),e instanceof TinCan.Activity||(e="string"==typeof e?{id:e}:e,e=new TinCan.Activity(e)),this[t].push(e),this[t].length-1},asVersion:function(t){this.log("asVersion");var e,n,r={},i=["parent","grouping","other"];for(t=t||TinCan.versions()[0],e=0;e<i.length;e+=1)if(null!==this[i[e]]&&0<this[i[e]].length)if("0.9"===t||"0.95"===t)1<this[i[e]].length&&this.log("[warning] version does not support multiple values in: "+i[e]),r[i[e]]=this[i[e]][0].asVersion(t);else for(r[i[e]]=[],n=0;n<this[i[e]].length;n+=1)r[i[e]].push(this[i[e]][n].asVersion(t));if(null!==this.category&&0<this.category.length){if("0.9"===t||"0.95"===t)throw this.log("[error] version does not support the 'category' property: "+t),new Error(t+" does not support the 'category' property");for(r.category=[],e=0;e<this.category.length;e+=1)r.category.push(this.category[e].asVersion(t))}return r}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.Context=function(t){this.log("constructor"),this.registration=null,this.instructor=null,this.team=null,this.contextActivities=null,this.revision=null,this.platform=null,this.language=null,this.statement=null,this.extensions=null,this.init(t)};n.prototype={LOG_SRC:"Context",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n,r,i=["registration","revision","platform","language","extensions"],o=["instructor","team"];for(t=t||{},e=0;e<i.length;e+=1)n=i[e],t.hasOwnProperty(n)&&null!==t[n]&&(this[n]=t[n]);for(e=0;e<o.length;e+=1)n=o[e],t.hasOwnProperty(n)&&null!==t[n]&&(void 0!==(r=t[n]).objectType&&"Person"!==r.objectType||(r.objectType="Agent"),"Agent"!==r.objectType||r instanceof TinCan.Agent?"Group"!==r.objectType||r instanceof TinCan.Group||(r=new TinCan.Group(r)):r=new TinCan.Agent(r),this[n]=r);t.hasOwnProperty("contextActivities")&&null!==t.contextActivities&&(t.contextActivities instanceof TinCan.ContextActivities?this.contextActivities=t.contextActivities:this.contextActivities=new TinCan.ContextActivities(t.contextActivities)),t.hasOwnProperty("statement")&&null!==t.statement&&(t.statement instanceof TinCan.StatementRef||t.statement instanceof TinCan.SubStatement?this.statement=t.statement:"StatementRef"===t.statement.objectType?this.statement=new TinCan.StatementRef(t.statement):"SubStatement"===t.statement.objectType?this.statement=new TinCan.SubStatement(t.statement):this.log("Unable to parse statement.context.statement property."))},asVersion:function(t){this.log("asVersion");var e,n={},r=["registration","revision","platform","language","extensions"],i=["instructor","team","contextActivities","statement"];if(t=t||TinCan.versions()[0],this.statement instanceof TinCan.SubStatement&&"0.9"!==t&&"0.95"!==t)throw this.log("[error] version does not support SubStatements in the 'statement' property: "+t),new Error(t+" does not support SubStatements in the 'statement' property");for(e=0;e<r.length;e+=1)null!==this[r[e]]&&(n[r[e]]=this[r[e]]);for(e=0;e<i.length;e+=1)null!==this[i[e]]&&(n[i[e]]=this[i[e]].asVersion(t));return n}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.StatementRef=function(t){this.log("constructor"),this.id=null,this.init(t)};n.prototype={objectType:"StatementRef",LOG_SRC:"StatementRef",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["id"];for(t=t||{},e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]])},toString:function(){return this.log("toString"),this.id},asVersion:function(t){this.log("asVersion");var e={objectType:this.objectType,id:this.id};return"0.9"===t&&(e.objectType="Statement"),e}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.SubStatement=function(t){this.log("constructor"),this.actor=null,this.verb=null,this.target=null,this.result=null,this.context=null,this.timestamp=null,this.init(t)};n.prototype={objectType:"SubStatement",LOG_SRC:"SubStatement",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["timestamp"];for((t=t||{}).hasOwnProperty("object")&&(t.target=t.object),t.hasOwnProperty("actor")&&(void 0!==t.actor.objectType&&"Person"!==t.actor.objectType||(t.actor.objectType="Agent"),"Agent"===t.actor.objectType?t.actor instanceof TinCan.Agent?this.actor=t.actor:this.actor=new TinCan.Agent(t.actor):"Group"===t.actor.objectType&&(t.actor instanceof TinCan.Group?this.actor=t.actor:this.actor=new TinCan.Group(t.actor))),t.hasOwnProperty("verb")&&(t.verb instanceof TinCan.Verb?this.verb=t.verb:this.verb=new TinCan.Verb(t.verb)),t.hasOwnProperty("target")&&(t.target instanceof TinCan.Activity||t.target instanceof TinCan.Agent||t.target instanceof TinCan.Group||t.target instanceof TinCan.SubStatement||t.target instanceof TinCan.StatementRef?this.target=t.target:(void 0===t.target.objectType&&(t.target.objectType="Activity"),"Activity"===t.target.objectType?this.target=new TinCan.Activity(t.target):"Agent"===t.target.objectType?this.target=new TinCan.Agent(t.target):"Group"===t.target.objectType?this.target=new TinCan.Group(t.target):"SubStatement"===t.target.objectType?this.target=new TinCan.SubStatement(t.target):"StatementRef"===t.target.objectType?this.target=new TinCan.StatementRef(t.target):this.log("Unrecognized target type: "+t.target.objectType))),t.hasOwnProperty("result")&&(t.result instanceof TinCan.Result?this.result=t.result:this.result=new TinCan.Result(t.result)),t.hasOwnProperty("context")&&(t.context instanceof TinCan.Context?this.context=t.context:this.context=new TinCan.Context(t.context)),e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]])},toString:function(t){return this.log("toString"),(null!==this.actor?this.actor.toString(t):"")+" "+(null!==this.verb?this.verb.toString(t):"")+" "+(null!==this.target?this.target.toString(t):"")},asVersion:function(t){this.log("asVersion");var e,n=["timestamp"],r=["actor","verb","result","context"],i={objectType:this.objectType};for(t=t||TinCan.versions()[0],e=0;e<n.length;e+=1)null!==this[n[e]]&&(i[n[e]]=this[n[e]]);for(e=0;e<r.length;e+=1)null!==this[r[e]]&&(i[r[e]]=this[r[e]].asVersion(t));return null!==this.target&&(i.object=this.target.asVersion(t)),"0.9"===t&&(i.objectType="Statement"),i}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.Statement=function(t,e){this.log("constructor"),void 0===(e="number"==typeof e?{storeOriginal:e}:e||{}).storeOriginal&&(e.storeOriginal=null),void 0===e.doStamp&&(e.doStamp=!0),this.id=null,this.actor=null,this.verb=null,this.target=null,this.result=null,this.context=null,this.timestamp=null,this.stored=null,this.authority=null,this.attachments=null,this.version=null,this.degraded=!1,this.voided=null,this.inProgress=null,this.originalJSON=null,this.init(t,e)};n.prototype={LOG_SRC:"Statement",log:TinCan.prototype.log,init:function(t,e){this.log("init");var n,r=["id","stored","timestamp","version","inProgress","voided"];if(t=t||{},e.storeOriginal&&(this.originalJSON=JSON.stringify(t,null,e.storeOriginal)),t.hasOwnProperty("object")&&(t.target=t.object),t.hasOwnProperty("actor")&&(void 0!==t.actor.objectType&&"Person"!==t.actor.objectType||(t.actor.objectType="Agent"),"Agent"===t.actor.objectType?t.actor instanceof TinCan.Agent?this.actor=t.actor:this.actor=new TinCan.Agent(t.actor):"Group"===t.actor.objectType&&(t.actor instanceof TinCan.Group?this.actor=t.actor:this.actor=new TinCan.Group(t.actor))),t.hasOwnProperty("authority")&&(void 0!==t.authority.objectType&&"Person"!==t.authority.objectType||(t.authority.objectType="Agent"),"Agent"===t.authority.objectType?t.authority instanceof TinCan.Agent?this.authority=t.authority:this.authority=new TinCan.Agent(t.authority):"Group"===t.authority.objectType&&(t.actor instanceof TinCan.Group?this.authority=t.authority:this.authority=new TinCan.Group(t.authority))),t.hasOwnProperty("verb")&&(t.verb instanceof TinCan.Verb?this.verb=t.verb:this.verb=new TinCan.Verb(t.verb)),t.hasOwnProperty("target")&&(t.target instanceof TinCan.Activity||t.target instanceof TinCan.Agent||t.target instanceof TinCan.Group||t.target instanceof TinCan.SubStatement||t.target instanceof TinCan.StatementRef?this.target=t.target:(void 0===t.target.objectType&&(t.target.objectType="Activity"),"Activity"===t.target.objectType?this.target=new TinCan.Activity(t.target):"Agent"===t.target.objectType?this.target=new TinCan.Agent(t.target):"Group"===t.target.objectType?this.target=new TinCan.Group(t.target):"SubStatement"===t.target.objectType?this.target=new TinCan.SubStatement(t.target):"StatementRef"===t.target.objectType?this.target=new TinCan.StatementRef(t.target):this.log("Unrecognized target type: "+t.target.objectType))),t.hasOwnProperty("result")&&(t.result instanceof TinCan.Result?this.result=t.result:this.result=new TinCan.Result(t.result)),t.hasOwnProperty("context")&&(t.context instanceof TinCan.Context?this.context=t.context:this.context=new TinCan.Context(t.context)),t.hasOwnProperty("attachments")&&null!==t.attachments)for(this.attachments=[],n=0;n<t.attachments.length;n+=1)t.attachments[n]instanceof TinCan.Attachment?this.attachments.push(t.attachments[n]):this.attachments.push(new TinCan.Attachment(t.attachments[n]));for(n=0;n<r.length;n+=1)t.hasOwnProperty(r[n])&&null!==t[r[n]]&&(this[r[n]]=t[r[n]]);e.doStamp&&this.stamp()},toString:function(t){return this.log("toString"),(null!==this.actor?this.actor.toString(t):"")+" "+(null!==this.verb?this.verb.toString(t):"")+" "+(null!==this.target?this.target.toString(t):"")},asVersion:function(t){this.log("asVersion");var e,n={},r=["id","timestamp"],i=["actor","verb","result","context","authority"];for(t=t||TinCan.versions()[0],e=0;e<r.length;e+=1)null!==this[r[e]]&&(n[r[e]]=this[r[e]]);for(e=0;e<i.length;e+=1)null!==this[i[e]]&&(n[i[e]]=this[i[e]].asVersion(t));if(null!==this.target&&(n.object=this.target.asVersion(t)),"0.9"!==t&&"0.95"!==t||null!==this.voided&&(n.voided=this.voided),"0.9"===t&&null!==this.inProgress&&(n.inProgress=this.inProgress),null!==this.attachments&&"0.9"!==t&&"0.95"!==t)for(n.attachments=[],e=0;e<this.attachments.length;e+=1)this.attachments[e]instanceof TinCan.Attachment?n.attachments.push(this.attachments[e].asVersion(t)):n.attachments.push(new TinCan.Attachment(this.attachments[e]).asVersion(t));return n},stamp:function(){this.log("stamp"),null===this.id&&(this.id=TinCan.Utils.getUUID()),null===this.timestamp&&(this.timestamp=TinCan.Utils.getISODateString(new Date))},hasAttachmentWithContent:function(){var t;if(this.log("hasAttachmentWithContent"),null===this.attachments)return!1;for(t=0;t<this.attachments.length;t+=1)if(null!==this.attachments[t].content)return!0;return!1}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var o=TinCan.StatementsResult=function(t){this.log("constructor"),this.statements=null,this.more=null,this.init(t)};o.prototype={LOG_SRC:"StatementsResult",log:TinCan.prototype.log,init:function(t){this.log("init"),(t=t||{}).hasOwnProperty("statements")&&(this.statements=t.statements),t.hasOwnProperty("more")&&(this.more=t.more)}},o.fromJSON=function(t){o.prototype.log("fromJSON");var e,n,r,i=[];try{e=JSON.parse(t)}catch(t){o.prototype.log("fromJSON - JSON.parse error: "+t)}if(e){for(r=0;r<e.statements.length;r+=1){try{n=new TinCan.Statement(e.statements[r],4)}catch(t){o.prototype.log("fromJSON - statement instantiation failed: "+t+" ("+JSON.stringify(e.statements[r])+")"),n=new TinCan.Statement({id:e.statements[r].id},4)}i.push(n)}e.statements=i}return new o(e)}}(),function(){"use strict";var n=TinCan.State=function(t){this.log("constructor"),this.id=null,this.updated=null,this.contents=null,this.etag=null,this.contentType=null,this.init(t)};n.prototype={LOG_SRC:"State",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["id","contents","etag","contentType"];for(t=t||{},e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]]);this.updated=!1}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.ActivityProfile=function(t){this.log("constructor"),this.id=null,this.activity=null,this.updated=null,this.contents=null,this.etag=null,this.contentType=null,this.init(t)};n.prototype={LOG_SRC:"ActivityProfile",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["id","contents","etag","contentType"];for((t=t||{}).hasOwnProperty("activity")&&(t.activity instanceof TinCan.Activity?this.activity=t.activity:this.activity=new TinCan.Activity(t.activity)),e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]]);this.updated=!1}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.AgentProfile=function(t){this.log("constructor"),this.id=null,this.agent=null,this.updated=null,this.contents=null,this.etag=null,this.contentType=null,this.init(t)};n.prototype={LOG_SRC:"AgentProfile",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["id","contents","etag","contentType"];for((t=t||{}).hasOwnProperty("agent")&&(t.agent instanceof TinCan.Agent?this.agent=t.agent:this.agent=new TinCan.Agent(t.agent)),e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]]);this.updated=!1}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.About=function(t){this.log("constructor"),this.version=null,this.init(t)};n.prototype={LOG_SRC:"About",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["version"];for(t=t||{},e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]])}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)}}(),function(){"use strict";var n=TinCan.Attachment=function(t){this.log("constructor"),this.usageType=null,this.display=null,this.contentType=null,this.length=null,this.sha2=null,this.description=null,this.fileUrl=null,this.content=null,this.init(t)};n.prototype={LOG_SRC:"Attachment",log:TinCan.prototype.log,init:function(t){this.log("init");var e,n=["contentType","length","sha2","usageType","display","description","fileUrl"];for(t=t||{},e=0;e<n.length;e+=1)t.hasOwnProperty(n[e])&&null!==t[n[e]]&&(this[n[e]]=t[n[e]]);t.hasOwnProperty("content")&&null!==t.content&&("string"==typeof t.content?this.setContentFromString(t.content):this.setContent(t.content))},asVersion:function(t){var e;return this.log("asVersion"),"0.9"===(t=t||TinCan.versions()[0])||"0.95"===t?e=null:(e={contentType:this.contentType,display:this.display,length:this.length,sha2:this.sha2,usageType:this.usageType},null!==this.fileUrl&&(e.fileUrl=this.fileUrl),null!==this.description&&(e.description=this.description)),e},getLangDictionaryValue:TinCan.Utils.getLangDictionaryValue,setContent:function(t){this.content=t,this.length=t.byteLength,this.sha2=TinCan.Utils.getSHA256String(t)},setContentFromString:function(t){var e=TinCan.Utils.stringToArrayBuffer(t);this.setContent(e)},getContentAsString:function(){return TinCan.Utils.stringFromArrayBuffer(this.content)}},n.fromJSON=function(t){n.prototype.log("fromJSON");var e=JSON.parse(t);return new n(e)},n._defaultEncoding="utf-8"}(),function(){"use strict";var LOG_SRC="Environment.Browser",requestComplete,__IEModeConversion,nativeRequest,xdrRequest,__createJSONSegment,__createAttachmentSegment,__delay,env={},log=TinCan.prototype.log;"undefined"!=typeof window?(window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(t){var e,n,r="";if(t instanceof Object){if(t.constructor===Array){for(e=0;e<t.length;e+=1)r+=this.stringify(t[e])+",";return"["+r.substr(0,r.length-1)+"]"}if(t.toString!==Object.prototype.toString)return'"'+t.toString().replace(/"/g,"\\$&")+'"';for(n in t)t.hasOwnProperty(n)&&(r+='"'+n.replace(/"/g,"\\$&")+'":'+this.stringify(t[n])+",");return"{"+r.substr(0,r.length-1)+"}"}return"string"==typeof t?'"'+t.replace(/"/g,"\\$&")+'"':String(t)}}),Date.now||(Date.now=function(){return+new Date}),Array.prototype.forEach||(Array.prototype.forEach=function(t){if(null==this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=arguments[1],i=0;i<n;i+=1)i in e&&t.call(r,e[i],i,e)}),env.hasCORS=!1,env.useXDR=!1,"undefined"!=typeof XMLHttpRequest&&void 0!==(new XMLHttpRequest).withCredentials?env.hasCORS=!0:"undefined"!=typeof XDomainRequest&&(env.hasCORS=!0,env.useXDR=!0),requestComplete=function(t,e,n){var r,i,o;return log("requestComplete: "+n.finished+", xhr.status: "+t.status,LOG_SRC),o=void 0===t.status?n.fakeStatus:1223===t.status?204:t.status,n.finished?r:(n.finished=!0,i=e.ignore404&&404===o,200<=o&&o<400||i?e.callback?void e.callback(null,t):r={err:null,xhr:t}:(r={err:o,xhr:t},log(0===o?"[warning] There was a problem communicating with the Learning Record Store. Aborted, offline, or invalid CORS endpoint ("+o+")":"[warning] There was a problem communicating with the Learning Record Store. ("+o+" | "+t.responseText+")",LOG_SRC),e.callback&&e.callback(o,t),r))},__IEModeConversion=function(t,e,n,r){var i;for(i in e)e.hasOwnProperty(i)&&n.push(i+"="+encodeURIComponent(e[i]));return void 0!==r.data&&n.push("content="+encodeURIComponent(r.data)),e["Content-Type"]="application/x-www-form-urlencoded",t+="?method="+r.method,r.method="POST",r.params={},0<n.length&&(r.data=n.join("&")),t},nativeRequest=function(t,e,n){log("sendRequest using XMLHttpRequest",LOG_SRC);var r,i,o,s,a=this,l=[],c={finished:!1,fakeStatus:null},u=void 0!==n.callback,h=t;for(i in log("sendRequest using XMLHttpRequest - async: "+u,LOG_SRC),n.params)n.params.hasOwnProperty(i)&&l.push(i+"="+encodeURIComponent(n.params[i]));if(0<l.length&&(h+="?"+l.join("&")),2048<=h.length){if(void 0===n.method)return s=new Error("method must not be undefined for an IE Mode Request conversion"),void 0!==n.callback&&n.callback(s,null),{err:s,xhr:null};t=__IEModeConversion(t,e,l,n)}else t=h;if("undefined"!=typeof XMLHttpRequest)r=new XMLHttpRequest;else if(r=new ActiveXObject("Microsoft.XMLHTTP"),n.expectMultipart)return s=new Error("Attachment support not available"),void 0!==n.callback&&n.callback(s,null),{err:s,xhr:null};for(i in r.open(n.method,t,u),n.expectMultipart&&(r.responseType="arraybuffer"),e)e.hasOwnProperty(i)&&r.setRequestHeader(i,e[i]);o=n.data,u&&(r.onreadystatechange=function(){log("xhr.onreadystatechange - xhr.readyState: "+r.readyState,LOG_SRC),4===r.readyState&&requestComplete.call(a,r,n,c)});try{r.send(o)}catch(t){log("sendRequest caught send exception: "+t,LOG_SRC)}return u?r:requestComplete.call(this,r,n,c)},xdrRequest=function(t,e,n){log("sendRequest using XDomainRequest",LOG_SRC);var r,i,o,s,a,l=this,c=[],u={finished:!1,fakeStatus:null};if(n.expectMultipart)return a=new Error("Attachment support not available"),void 0!==n.callback&&n.callback(a,null),{err:a,xhr:null};for(o in t+="?method="+n.method,n.params)n.params.hasOwnProperty(o)&&c.push(o+"="+encodeURIComponent(n.params[o]));for(o in e)e.hasOwnProperty(o)&&c.push(o+"="+encodeURIComponent(e[o]));void 0!==n.data&&c.push("content="+encodeURIComponent(n.data)),i=c.join("&"),(r=new XDomainRequest).open("POST",t),n.callback?(r.onload=function(){u.fakeStatus=200,requestComplete.call(l,r,n,u)},r.onerror=function(){u.fakeStatus=400,requestComplete.call(l,r,n,u)},r.ontimeout=function(){u.fakeStatus=0,requestComplete.call(l,r,n,u)}):(r.onload=function(){u.fakeStatus=200},r.onerror=function(){u.fakeStatus=400},r.ontimeout=function(){u.fakeStatus=0}),r.onprogress=function(){},r.timeout=0;try{r.send(i)}catch(t){log("sendRequest caught send exception: "+t,LOG_SRC)}if(n.callback)return r;for(s=1e4+Date.now(),log("sendRequest - until: "+s+", finished: "+u.finished,LOG_SRC);Date.now()<s&&null===u.fakeStatus;)__delay();return requestComplete.call(l,r,n,u)},TinCan.LRS.prototype._initByEnvironment=function(t){var e,n,r;if(log("_initByEnvironment",LOG_SRC),t=t||{},this._makeRequest=nativeRequest,this._IEModeConversion=__IEModeConversion,null===(e=this.endpoint.toLowerCase().match(/([A-Za-z]+:)\/\/([^:\/]+):?(\d+)?(\/.*)?$/)))throw log("[error] LRS invalid: failed to divide URL parts",LOG_SRC),{code:4,mesg:"LRS invalid: failed to divide URL parts"};if(r=location.port,n=location.protocol.toLowerCase()===e[1],""===r&&(r="http:"===location.protocol.toLowerCase()?"80":"https:"===location.protocol.toLowerCase()?"443":""),!n||location.hostname.toLowerCase()!==e[2]||r!==(null!==e[3]&&void 0!==e[3]&&""!==e[3]?e[3]:"http:"===e[1]?"80":"https:"===e[1]?"443":""))if(env.hasCORS){if(env.useXDR&&n)this._makeRequest=xdrRequest;else if(env.useXDR&&!n){if(!t.allowFail)throw log("[error] LRS invalid: cross domain request for differing scheme in IE with XDR",LOG_SRC),{code:2,mesg:"LRS invalid: cross domain request for differing scheme in IE with XDR"};log("[warning] LRS invalid: cross domain request for differing scheme in IE with XDR (allowed to fail)",LOG_SRC)}}else{if(!t.allowFail)throw log("[error] LRS invalid: cross domain requests not supported in this browser",LOG_SRC),{code:1,mesg:"LRS invalid: cross domain requests not supported in this browser"};log("[warning] LRS invalid: cross domain requests not supported in this browser (allowed to fail)",LOG_SRC)}},__delay=function(){var t=new XMLHttpRequest,e=window.location+"?forcenocache="+TinCan.Utils.getUUID();t.open("GET",e,!1),t.send(null)},TinCan.LRS.syncEnabled=!0,TinCan.LRS.prototype._getMultipartRequestData=function(t,e,n){var r,i=[];for(i.push(__createJSONSegment(t,e)),r=0;r<n.length;r+=1)null!==n[r].content&&i.push(__createAttachmentSegment(t,n[r].content,n[r].sha2,n[r].contentType));return i.push("\r\n--"+t+"--\r\n"),new Blob(i)},__createJSONSegment=function(t,e){var n=["--"+t,"Content-Type: application/json","",JSON.stringify(e)].join("\r\n");return n+="\r\n"},__createAttachmentSegment=function(t,e,n,r){var i=[],o=["--"+t,"Content-Type: "+r,"Content-Transfer-Encoding: binary","X-Experience-API-Hash: "+n].join("\r\n");return o+="\r\n\r\n",i.push(o),i.push(e),new Blob(i)},TinCan.Utils.stringToArrayBuffer=function(t,e){return e=e||TinCan.Utils.defaultEncoding,new TextEncoder(e).encode(t).buffer},TinCan.Utils.stringFromArrayBuffer=function(t,e){return e=e||TinCan.Utils.defaultEncoding,new TextDecoder(e).decode(t)}):log("'window' not defined",LOG_SRC)}(),function(f){"use strict";var d=void 0,e=1e5;function g(t){switch(typeof t){case"undefined":return"undefined";case"boolean":return"boolean";case"number":return"number";case"string":return"string";default:return null===t?"null":"object"}}function v(t){return Object.prototype.toString.call(t).replace(/^\[object *|\]$/g,"")}function y(t){return"function"==typeof t}function m(t){if(null===t||t===d)throw TypeError();return Object(t)}function b(t){return t>>>0}var r,t,n,l,S=Math.LN2,w=Math.abs,_=Math.floor,T=Math.log,x=Math.max,O=Math.min,C=Math.pow,i=Math.round;function A(n){if(!("TYPED_ARRAY_POLYFILL_NO_ARRAY_ACCESSORS"in f)){if(n.length>e)throw RangeError("Array too large for polyfill");for(var t=0;t<n.length;t+=1)!function(e){Object.defineProperty(n,e,{get:function(){return n._getter(e)},set:function(t){n._setter(e,t)},enumerable:!0,configurable:!1})}(t)}}function o(t,e){var n=32-e;return t<<n>>n}function s(t,e){var n=32-e;return t<<n>>>n}function P(t){return[255&t]}function R(t){return o(t[0],8)}function E(t){return[255&t]}function L(t){return s(t[0],8)}function j(t){return[(t=i(Number(t)))<0?0:255<t?255:255&t]}function N(t){return[255&t,t>>8&255]}function U(t){return o(t[1]<<8|t[0],16)}function I(t){return[255&t,t>>8&255]}function k(t){return s(t[1]<<8|t[0],16)}function J(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function H(t){return o(t[3]<<24|t[2]<<16|t[1]<<8|t[0],32)}function D(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function q(t){return s(t[3]<<24|t[2]<<16|t[1]<<8|t[0],32)}function a(t,e,n){var r,i,o,s,a,l=(1<<e-1)-1;function c(t){var e=_(t),n=t-e;return!(n<.5)&&(.5<n||e%2)?e+1:e}t!=t?(r=(1<<e)-1,s=C(2,n-1),a=0):t===1/0||t===-1/0?(r=(1<<e)-1,a=t<(s=0)?1:0):0===t?a=1/t==-1/(s=r=0)?1:0:(a=t<0,(t=w(t))>=C(2,1-l)?(r=O(_(T(t)/S),1023),(i=t/C(2,r))<1&&(--r,i*=2),2<=i&&(r+=1,i/=2),r+=l,1<=(s=c(i*(o=C(2,n)))-o)/o&&(r+=1,s=0),2*l<r&&(r=(1<<e)-1,s=0)):(r=0,s=c(t/C(2,1-l-n))));for(var u=[],h=n;h;--h)u.push(s%2?1:0),s=_(s/2);for(h=e;h;--h)u.push(r%2?1:0),r=_(r/2);u.push(a?1:0),u.reverse();for(var p=u.join(""),f=[];p.length;)f.unshift(parseInt(p.substring(0,8),2)),p=p.substring(8);return f}function c(t,e,n){for(var r,i,o,s,a,l,c,u=[],h=0;h<t.length;++h)for(i=t[h],r=8;r;--r)u.push(i%2?1:0),i>>=1;return u.reverse(),o=u.join(""),s=(1<<e-1)-1,a=parseInt(o.substring(0,1),2)?-1:1,l=parseInt(o.substring(1,1+e),2),c=parseInt(o.substring(1+e),2),l===(1<<e)-1?0!==c?NaN:1/0*a:0<l?a*C(2,l-s)*(1+c/C(2,n)):0!==c?a*C(2,-(s-1))*(c/C(2,n)):a<0?-0:0}function B(t){return c(t,11,52)}function M(t){return a(t,11,52)}function F(t){return c(t,8,23)}function z(t){return a(t,8,23)}function u(t,e){return y(t.get)?t.get(e):t[e]}function h(t,e,n){if(!(t instanceof ArrayBuffer||"ArrayBuffer"===v(t)))throw TypeError();if((e=b(e))>t.byteLength)throw RangeError("byteOffset out of range");if(e+(n=n===d?t.byteLength-e:b(n))>t.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:t}),Object.defineProperty(this,"byteLength",{value:n}),Object.defineProperty(this,"byteOffset",{value:e})}function p(o){return function(t,e){if((t=b(t))+o.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");t+=this.byteOffset;for(var n=new Uint8Array(this.buffer,t,o.BYTES_PER_ELEMENT),r=[],i=0;i<o.BYTES_PER_ELEMENT;i+=1)r.push(u(n,i));return Boolean(e)===Boolean(l)&&r.reverse(),u(new o(new Uint8Array(r).buffer),0)}}function V(a){return function(t,e,n){if((t=b(t))+a.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");for(var r=new a([e]),i=new Uint8Array(r.buffer),o=[],s=0;s<a.BYTES_PER_ELEMENT;s+=1)o.push(u(i,s));Boolean(n)===Boolean(l)&&o.reverse(),new Uint8Array(this.buffer,t,a.BYTES_PER_ELEMENT).set(o)}}r=Object.defineProperty,t=!function(){try{return Object.defineProperty({},"x",{})}catch(t){return}}(),r&&!t||(Object.defineProperty=function(t,e,n){if(r)try{return r(t,e,n)}catch(t){}if(t!==Object(t))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in n&&Object.prototype.__defineGetter__.call(t,e,n.get),Object.prototype.__defineSetter__&&"set"in n&&Object.prototype.__defineSetter__.call(t,e,n.set),"value"in n&&(t[e]=n.value),t}),function(){function i(t){if((t>>=0)<0)throw RangeError("ArrayBuffer size is not a small enough positive integer.");Object.defineProperty(this,"byteLength",{value:t}),Object.defineProperty(this,"_bytes",{value:Array(t)});for(var e=0;e<t;e+=1)this._bytes[e]=0}function o(){if(!arguments.length||"object"!=typeof arguments[0])return function(t){if((t>>=0)<0)throw RangeError("length is not a small enough positive integer.");Object.defineProperty(this,"length",{value:t}),Object.defineProperty(this,"byteLength",{value:t*this.BYTES_PER_ELEMENT}),Object.defineProperty(this,"buffer",{value:new i(this.byteLength)}),Object.defineProperty(this,"byteOffset",{value:0})}.apply(this,arguments);if(1<=arguments.length&&"object"===g(arguments[0])&&arguments[0]instanceof o)return function(t){if(this.constructor!==t.constructor)throw TypeError();var e=t.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new i(e)}),Object.defineProperty(this,"byteLength",{value:e}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:t.length});for(var n=0;n<this.length;n+=1)this._setter(n,t._getter(n))}.apply(this,arguments);if(1<=arguments.length&&"object"===g(arguments[0])&&!(arguments[0]instanceof o)&&!(arguments[0]instanceof i||"ArrayBuffer"===v(arguments[0])))return function(t){var e=t.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new i(e)}),Object.defineProperty(this,"byteLength",{value:e}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:t.length});for(var n=0;n<this.length;n+=1){var r=t[n];this._setter(n,Number(r))}}.apply(this,arguments);if(1<=arguments.length&&"object"===g(arguments[0])&&(arguments[0]instanceof i||"ArrayBuffer"===v(arguments[0])))return function(t,e,n){if((e=b(e))>t.byteLength)throw RangeError("byteOffset out of range");if(e%this.BYTES_PER_ELEMENT)throw RangeError("buffer length minus the byteOffset is not a multiple of the element size.");if(n===d){var r=t.byteLength-e;if(r%this.BYTES_PER_ELEMENT)throw RangeError("length of buffer minus byteOffset not a multiple of the element size");n=r/this.BYTES_PER_ELEMENT}else r=(n=b(n))*this.BYTES_PER_ELEMENT;if(e+r>t.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:t}),Object.defineProperty(this,"byteLength",{value:r}),Object.defineProperty(this,"byteOffset",{value:e}),Object.defineProperty(this,"length",{value:n})}.apply(this,arguments);throw TypeError()}f.ArrayBuffer=f.ArrayBuffer||i,Object.defineProperty(o,"from",{value:function(t){return new this(t)}}),Object.defineProperty(o,"of",{value:function(){return new this(arguments)}});var s={};function t(t,e,n){var r=function(){Object.defineProperty(this,"constructor",{value:r}),o.apply(this,arguments),A(this)};"__proto__"in r?r.__proto__=o:(r.from=o.from,r.of=o.of),r.BYTES_PER_ELEMENT=t;function i(){}return i.prototype=s,r.prototype=new i,Object.defineProperty(r.prototype,"BYTES_PER_ELEMENT",{value:t}),Object.defineProperty(r.prototype,"_pack",{value:e}),Object.defineProperty(r.prototype,"_unpack",{value:n}),r}o.prototype=s,Object.defineProperty(o.prototype,"_getter",{value:function(t){if(arguments.length<1)throw SyntaxError("Not enough arguments");if((t=b(t))>=this.length)return d;for(var e=[],n=0,r=this.byteOffset+t*this.BYTES_PER_ELEMENT;n<this.BYTES_PER_ELEMENT;n+=1,r+=1)e.push(this.buffer._bytes[r]);return this._unpack(e)}}),Object.defineProperty(o.prototype,"get",{value:o.prototype._getter}),Object.defineProperty(o.prototype,"_setter",{value:function(t,e){if(arguments.length<2)throw SyntaxError("Not enough arguments");if(!((t=b(t))>=this.length))for(var n=this._pack(e),r=0,i=this.byteOffset+t*this.BYTES_PER_ELEMENT;r<this.BYTES_PER_ELEMENT;r+=1,i+=1)this.buffer._bytes[i]=n[r]}}),Object.defineProperty(o.prototype,"constructor",{value:o}),Object.defineProperty(o.prototype,"copyWithin",{value:function(t,e){var n,r=arguments[2],i=m(this),o=b(i.length),o=x(o,0),s=t>>0,a=s<0?x(o+s,0):O(s,o),l=e>>0,c=l<0?x(o+l,0):O(l,o),u=r===d?o:r>>0,h=u<0?x(o+u,0):O(u,o),p=O(h-c,o-a);for(c<a&&a<c+p?(n=-1,c=c+p-1,a=a+p-1):n=1;0<p;)i._setter(a,i._getter(c)),c+=n,a+=n,--p;return i}}),Object.defineProperty(o.prototype,"every",{value:function(t){if(this===d||null===this)throw TypeError();var e=Object(this),n=b(e.length);if(!y(t))throw TypeError();for(var r=arguments[1],i=0;i<n;i++)if(!t.call(r,e._getter(i),i,e))return!1;return!0}}),Object.defineProperty(o.prototype,"fill",{value:function(t){for(var e=arguments[1],n=arguments[2],r=m(this),i=b(r.length),i=x(i,0),o=e>>0,s=o<0?x(i+o,0):O(o,i),a=n===d?i:n>>0,l=a<0?x(i+a,0):O(a,i);s<l;)r._setter(s,t),s+=1;return r}}),Object.defineProperty(o.prototype,"filter",{value:function(t){if(this===d||null===this)throw TypeError();var e=Object(this),n=b(e.length);if(!y(t))throw TypeError();for(var r=[],i=arguments[1],o=0;o<n;o++){var s=e._getter(o);t.call(i,s,o,e)&&r.push(s)}return new this.constructor(r)}}),Object.defineProperty(o.prototype,"find",{value:function(t){var e=m(this),n=b(e.length);if(!y(t))throw TypeError();for(var r=1<arguments.length?arguments[1]:d,i=0;i<n;){var o=e._getter(i),s=t.call(r,o,i,e);if(Boolean(s))return o;++i}return d}}),Object.defineProperty(o.prototype,"findIndex",{value:function(t){var e=m(this),n=b(e.length);if(!y(t))throw TypeError();for(var r=1<arguments.length?arguments[1]:d,i=0;i<n;){var o=e._getter(i),s=t.call(r,o,i,e);if(Boolean(s))return i;++i}return-1}}),Object.defineProperty(o.prototype,"forEach",{value:function(t){if(this===d||null===this)throw TypeError();var e=Object(this),n=b(e.length);if(!y(t))throw TypeError();for(var r=arguments[1],i=0;i<n;i++)t.call(r,e._getter(i),i,e)}}),Object.defineProperty(o.prototype,"indexOf",{value:function(t){if(this===d||null===this)throw TypeError();var e=Object(this),n=b(e.length);if(0===n)return-1;var r=0;if(0<arguments.length&&((r=Number(arguments[1]))!=r?r=0:0!==r&&r!==1/0&&r!==-1/0&&(r=(0<r||-1)*_(w(r)))),n<=r)return-1;for(var i=0<=r?r:x(n-w(r),0);i<n;i++)if(e._getter(i)===t)return i;return-1}}),Object.defineProperty(o.prototype,"join",{value:function(t){if(this===d||null===this)throw TypeError();for(var e=Object(this),n=b(e.length),r=Array(n),i=0;i<n;++i)r[i]=e._getter(i);return r.join(t===d?",":t)}}),Object.defineProperty(o.prototype,"lastIndexOf",{value:function(t){if(this===d||null===this)throw TypeError();var e=Object(this),n=b(e.length);if(0===n)return-1;var r=n;1<arguments.length&&((r=Number(arguments[1]))!=r?r=0:0!==r&&r!==1/0&&r!==-1/0&&(r=(0<r||-1)*_(w(r))));for(var i=0<=r?O(r,n-1):n-w(r);0<=i;i--)if(e._getter(i)===t)return i;return-1}}),Object.defineProperty(o.prototype,"map",{value:function(t){if(this===d||null===this)throw TypeError();var e=Object(this),n=b(e.length);if(!y(t))throw TypeError();var r=[];r.length=n;for(var i=arguments[1],o=0;o<n;o++)r[o]=t.call(i,e._getter(o),o,e);return new this.constructor(r)}}),Object.defineProperty(o.prototype,"reduce",{value:function(t){if(this===d||null===this)throw TypeError();var e=Object(this),n=b(e.length);if(!y(t))throw TypeError();if(0===n&&1===arguments.length)throw TypeError();for(var r=0,i=2<=arguments.length?arguments[1]:e._getter(r++);r<n;)i=t.call(d,i,e._getter(r),r,e),r++;return i}}),Object.defineProperty(o.prototype,"reduceRight",{value:function(t){if(this===d||null===this)throw TypeError();var e=Object(this),n=b(e.length);if(!y(t))throw TypeError();if(0===n&&1===arguments.length)throw TypeError();for(var r=n-1,i=2<=arguments.length?arguments[1]:e._getter(r--);0<=r;)i=t.call(d,i,e._getter(r),r,e),r--;return i}}),Object.defineProperty(o.prototype,"reverse",{value:function(){if(this===d||null===this)throw TypeError();for(var t=Object(this),e=b(t.length),n=_(e/2),r=0,i=e-1;r<n;++r,--i){var o=t._getter(r);t._setter(r,t._getter(i)),t._setter(i,o)}return t}}),Object.defineProperty(o.prototype,"set",{value:function(t,e){if(arguments.length<1)throw SyntaxError("Not enough arguments");var n,r,i,o,s,a,l,c,u,h;if("object"==typeof t&&t.constructor===this.constructor){if((i=b(e))+(n=t).length>this.length)throw RangeError("Offset plus length of array is out of range");if(c=this.byteOffset+i*this.BYTES_PER_ELEMENT,u=n.length*this.BYTES_PER_ELEMENT,n.buffer===this.buffer){for(h=[],s=0,a=n.byteOffset;s<u;s+=1,a+=1)h[s]=n.buffer._bytes[a];for(s=0,l=c;s<u;s+=1,l+=1)this.buffer._bytes[l]=h[s]}else for(s=0,a=n.byteOffset,l=c;s<u;s+=1,a+=1,l+=1)this.buffer._bytes[l]=n.buffer._bytes[a]}else{if("object"!=typeof t||void 0===t.length)throw TypeError("Unexpected argument type(s)");if(o=b((r=t).length),(i=b(e))+o>this.length)throw RangeError("Offset plus length of array is out of range");for(s=0;s<o;s+=1)a=r[s],this._setter(i+s,Number(a))}}}),Object.defineProperty(o.prototype,"slice",{value:function(t,e){for(var n=m(this),r=b(n.length),i=t>>0,o=i<0?x(r+i,0):O(i,r),s=e===d?r:e>>0,a=s<0?x(r+s,0):O(s,r),l=a-o,c=new n.constructor(l),u=0;o<a;){var h=n._getter(o);c._setter(u,h),++o,++u}return c}}),Object.defineProperty(o.prototype,"some",{value:function(t){if(this===d||null===this)throw TypeError();var e=Object(this),n=b(e.length);if(!y(t))throw TypeError();for(var r=arguments[1],i=0;i<n;i++)if(t.call(r,e._getter(i),i,e))return!0;return!1}}),Object.defineProperty(o.prototype,"sort",{value:function(t){if(this===d||null===this)throw TypeError();for(var e=Object(this),n=b(e.length),r=Array(n),i=0;i<n;++i)r[i]=e._getter(i);for(t?r.sort(t):r.sort(),i=0;i<n;++i)e._setter(i,r[i]);return e}}),Object.defineProperty(o.prototype,"subarray",{value:function(t,e){function n(t,e,n){return t<e?e:n<t?n:t}t>>=0,e>>=0,arguments.length<1&&(t=0),arguments.length<2&&(e=this.length),t<0&&(t=this.length+t),e<0&&(e=this.length+e),t=n(t,0,this.length);var r=(e=n(e,0,this.length))-t;return r<0&&(r=0),new this.constructor(this.buffer,this.byteOffset+t*this.BYTES_PER_ELEMENT,r)}});var e=t(1,P,R),n=t(1,E,L),r=t(1,j,L),a=t(2,N,U),l=t(2,I,k),c=t(4,J,H),u=t(4,D,q),h=t(4,z,F),p=t(8,M,B);f.Int8Array=f.Int8Array||e,f.Uint8Array=f.Uint8Array||n,f.Uint8ClampedArray=f.Uint8ClampedArray||r,f.Int16Array=f.Int16Array||a,f.Uint16Array=f.Uint16Array||l,f.Int32Array=f.Int32Array||c,f.Uint32Array=f.Uint32Array||u,f.Float32Array=f.Float32Array||h,f.Float64Array=f.Float64Array||p}(),n=new Uint16Array([4660]),l=18===u(new Uint8Array(n.buffer),0),Object.defineProperty(h.prototype,"getUint8",{value:p(Uint8Array)}),Object.defineProperty(h.prototype,"getInt8",{value:p(Int8Array)}),Object.defineProperty(h.prototype,"getUint16",{value:p(Uint16Array)}),Object.defineProperty(h.prototype,"getInt16",{value:p(Int16Array)}),Object.defineProperty(h.prototype,"getUint32",{value:p(Uint32Array)}),Object.defineProperty(h.prototype,"getInt32",{value:p(Int32Array)}),Object.defineProperty(h.prototype,"getFloat32",{value:p(Float32Array)}),Object.defineProperty(h.prototype,"getFloat64",{value:p(Float64Array)}),Object.defineProperty(h.prototype,"setUint8",{value:V(Uint8Array)}),Object.defineProperty(h.prototype,"setInt8",{value:V(Int8Array)}),Object.defineProperty(h.prototype,"setUint16",{value:V(Uint16Array)}),Object.defineProperty(h.prototype,"setInt16",{value:V(Int16Array)}),Object.defineProperty(h.prototype,"setUint32",{value:V(Uint32Array)}),Object.defineProperty(h.prototype,"setInt32",{value:V(Int32Array)}),Object.defineProperty(h.prototype,"setFloat32",{value:V(Float32Array)}),Object.defineProperty(h.prototype,"setFloat64",{value:V(Float64Array)}),f.DataView=f.DataView||h}(self),function(){"use strict";function c(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(t,e){var n=this.byteLength,r=c(t,n),i=n;if(void 0!==e&&(i=c(e,n)),i<r)return new ArrayBuffer(0);var o=i-r,s=new ArrayBuffer(o),a=new Uint8Array(s),l=new Uint8Array(this,r,o);return a.set(l),s})}(),"undefined"!=typeof module&&module.exports&&(this["encoding-indexes"]=require("./encoding-indexes.js")["encoding-indexes"]),function(r){"use strict";function m(t,e,n){return e<=t&&t<=n}var l=Math.floor;function a(t){if(void 0===t)return{};if(t===Object(t))return t;throw TypeError("Could not convert argument to dictionary")}function u(t){return 0<=t&&t<=127}var c=u;function h(t){this.tokens=[].slice.call(t),this.tokens.reverse()}h.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.pop():-1},prepend:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.push(e.pop());else this.tokens.push(t)},push:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.unshift(e.shift());else this.tokens.unshift(t)}};function b(t,e){if(t)throw TypeError("Decoder error");return e||65533}function p(t){throw TypeError("The code point "+t+" could not be encoded.")}function i(t){return t=String(t).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(n,t)?n[t]:null}var t=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"},{encodings:[{labels:["866","cp866","csibm866","ibm866"],name:"IBM866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso88592","iso_8859-2","iso_8859-2:1987","l2","latin2"],name:"ISO-8859-2"},{labels:["csisolatin3","iso-8859-3","iso-ir-109","iso8859-3","iso88593","iso_8859-3","iso_8859-3:1988","l3","latin3"],name:"ISO-8859-3"},{labels:["csisolatin4","iso-8859-4","iso-ir-110","iso8859-4","iso88594","iso_8859-4","iso_8859-4:1988","l4","latin4"],name:"ISO-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso-ir-144","iso8859-5","iso88595","iso_8859-5","iso_8859-5:1988"],name:"ISO-8859-5"},{labels:["arabic","asmo-708","csiso88596e","csiso88596i","csisolatinarabic","ecma-114","iso-8859-6","iso-8859-6-e","iso-8859-6-i","iso-ir-127","iso8859-6","iso88596","iso_8859-6","iso_8859-6:1987"],name:"ISO-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso-ir-126","iso8859-7","iso88597","iso_8859-7","iso_8859-7:1987","sun_eu_greek"],name:"ISO-8859-7"},{labels:["csiso88598e","csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-e","iso-ir-138","iso8859-8","iso88598","iso_8859-8","iso_8859-8:1988","visual"],name:"ISO-8859-8"},{labels:["csiso88598i","iso-8859-8-i","logical"],name:"ISO-8859-8-I"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","iso885910","l6","latin6"],name:"ISO-8859-10"},{labels:["iso-8859-13","iso8859-13","iso885913"],name:"ISO-8859-13"},{labels:["iso-8859-14","iso8859-14","iso885914"],name:"ISO-8859-14"},{labels:["csisolatin9","iso-8859-15","iso8859-15","iso885915","iso_8859-15","l9"],name:"ISO-8859-15"},{labels:["iso-8859-16"],name:"ISO-8859-16"},{labels:["cskoi8r","koi","koi8","koi8-r","koi8_r"],name:"KOI8-R"},{labels:["koi8-ru","koi8-u"],name:"KOI8-U"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["dos-874","iso-8859-11","iso8859-11","iso885911","tis-620","windows-874"],name:"windows-874"},{labels:["cp1250","windows-1250","x-cp1250"],name:"windows-1250"},{labels:["cp1251","windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ansi_x3.4-1968","ascii","cp1252","cp819","csisolatin1","ibm819","iso-8859-1","iso-ir-100","iso8859-1","iso88591","iso_8859-1","iso_8859-1:1987","l1","latin1","us-ascii","windows-1252","x-cp1252"],name:"windows-1252"},{labels:["cp1253","windows-1253","x-cp1253"],name:"windows-1253"},{labels:["cp1254","csisolatin5","iso-8859-9","iso-ir-148","iso8859-9","iso88599","iso_8859-9","iso_8859-9:1989","l5","latin5","windows-1254","x-cp1254"],name:"windows-1254"},{labels:["cp1255","windows-1255","x-cp1255"],name:"windows-1255"},{labels:["cp1256","windows-1256","x-cp1256"],name:"windows-1256"},{labels:["cp1257","windows-1257","x-cp1257"],name:"windows-1257"},{labels:["cp1258","windows-1258","x-cp1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gb_2312","gb_2312-80","gbk","iso-ir-58","x-gbk"],name:"GBK"},{labels:["gb18030"],name:"gb18030"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"Big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"EUC-JP"},{labels:["csiso2022jp","iso-2022-jp"],name:"ISO-2022-JP"},{labels:["csshiftjis","ms932","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"Shift_JIS"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"EUC-KR"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["csiso2022kr","hz-gb-2312","iso-2022-cn","iso-2022-cn-ext","iso-2022-kr"],name:"replacement"},{labels:["utf-16be"],name:"UTF-16BE"},{labels:["utf-16","utf-16le"],name:"UTF-16LE"},{labels:["x-user-defined"],name:"x-user-defined"}],heading:"Legacy miscellaneous encodings"}],n={};t.forEach(function(t){t.encodings.forEach(function(e){e.labels.forEach(function(t){n[t]=e})})});var s={},f={};function S(t,e){return e&&e[t]||null}function d(t,e){var n=e.indexOf(t);return-1===n?null:n}function w(t){if(!("encoding-indexes"in r))throw Error("Indexes missing. Did you forget to include encoding-indexes.js?");return r["encoding-indexes"][t]}var o="utf-8";function g(t,e){if(!(this instanceof g))throw TypeError("Called as a function. Did you forget 'new'?");t=void 0!==t?String(t):o,e=a(e),this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode="replacement",this._do_not_flush=!1;var n=i(t);if(null===n||"replacement"===n.name)throw RangeError("Unknown encoding: "+t);if(!f[n.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js?");var r=this;return r._encoding=n,Boolean(e.fatal)&&(r._error_mode="fatal"),Boolean(e.ignoreBOM)&&(r._ignoreBOM=!0),Object.defineProperty||(this.encoding=r._encoding.name.toLowerCase(),this.fatal="fatal"===r._error_mode,this.ignoreBOM=r._ignoreBOM),r}function v(t,e){if(!(this instanceof v))throw TypeError("Called as a function. Did you forget 'new'?");e=a(e),this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=Boolean(e.fatal)?"fatal":"replacement";if(Boolean(e.NONSTANDARD_allowLegacyEncoding)){var n=i(t=void 0!==t?String(t):o);if(null===n||"replacement"===n.name)throw RangeError("Unknown encoding: "+t);if(!s[n.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js?");this._encoding=n}else this._encoding=i("utf-8"),void 0!==t&&"console"in r&&console.warn("TextEncoder constructor called with encoding label, which is ignored.");return Object.defineProperty||(this.encoding=this._encoding.name.toLowerCase()),this}function e(t){var r=t.fatal,i=0,o=0,s=0,a=128,l=191;this.handler=function(t,e){if(-1===e&&0!==s)return s=0,b(r);if(-1===e)return-1;if(0===s){if(m(e,0,127))return e;if(m(e,194,223))s=1,i=e-192;else if(m(e,224,239))224===e&&(a=160),237===e&&(l=159),s=2,i=e-224;else{if(!m(e,240,244))return b(r);240===e&&(a=144),244===e&&(l=143),s=3,i=e-240}return i<<=6*s,null}if(!m(e,a,l))return i=s=o=0,a=128,l=191,t.prepend(e),b(r);if(l=191,i+=e-(a=128)<<6*(s-(o+=1)),o!==s)return null;var n=i;return i=s=o=0,n}}function y(t){t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(m(e,0,127))return e;var n,r;m(e,128,2047)?(n=1,r=192):m(e,2048,65535)?(n=2,r=224):m(e,65536,1114111)&&(n=3,r=240);for(var i=[(e>>6*n)+r];0<n;){var o=e>>6*(n-1);i.push(128|63&o),--n}return i}}function _(r,t){var i=t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(u(e))return e;var n=r[e-128];return null===n?b(i):n}}function T(r,t){t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(c(e))return e;var n=d(e,r);return null===n&&p(e),n+128}}function x(t){var s=t.fatal,a=0,l=0,c=0;this.handler=function(t,e){if(-1===e&&0===a&&0===l&&0===c)return-1;var n;if(-1!==e||0===a&&0===l&&0===c||(c=l=a=0,b(s)),0!==c){n=null,m(e,48,57)&&(n=function(t){if(39419<t&&t<189e3||1237575<t)return null;if(7457===t)return 59335;for(var e=0,n=0,r=w("gb18030"),i=0;i<r.length;++i){var o=r[i];if(!(o[0]<=t))break;e=o[0],n=o[1]}return n+t-e}(10*(126*(10*(a-129)+(l-48))+(c-129))+e-48));var r=[l,c,e];return c=l=a=0,null===n?(t.prepend(r),b(s)):n}if(0!==l)return m(e,129,254)?(c=e,null):(t.prepend([l,e]),l=a=0,b(s));if(0===a)return u(e)?e:128===e?8364:m(e,129,254)?(a=e,null):b(s);if(m(e,48,57))return l=e,null;var i=a,o=null;return a=0,(m(e,64,126)||m(e,128,254))&&(o=190*(i-129)+(e-(e<127?64:65))),null===(n=null===o?null:S(o,w("gb18030")))&&u(e)&&t.prepend(e),null===n?b(s):n}}function O(t,a){t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(c(e))return e;if(58853===e)return p(e);if(a&&8364===e)return 128;var n=d(e,w("gb18030"));if(null!==n){var r=n%190;return[l(n/190)+129,r+(r<63?64:65)]}if(a)return p(e);n=function(t){if(59335===t)return 7457;for(var e=0,n=0,r=w("gb18030"),i=0;i<r.length;++i){var o=r[i];if(!(o[1]<=t))break;e=o[1],n=o[0]}return n+t-e}(e);var i=l(n/10/126/10),o=l((n-=10*i*126*10)/10/126),s=l((n-=10*o*126)/10);return[i+129,o+48,s+129,48+(n-10*s)]}}function C(t){var o=t.fatal,s=0;this.handler=function(t,e){if(-1===e&&0!==s)return s=0,b(o);if(-1===e&&0===s)return-1;if(0===s)return u(e)?e:m(e,129,254)?(s=e,null):b(o);var n=s,r=null;switch(s=0,(m(e,64,126)||m(e,161,254))&&(r=157*(n-129)+(e-(e<127?64:98))),r){case 1133:return[202,772];case 1135:return[202,780];case 1164:return[234,772];case 1166:return[234,780]}var i=null===r?null:S(r,w("big5"));return null===i&&u(e)&&t.prepend(e),null===i?b(o):i}}function A(t){t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(c(e))return e;var n,r,i=(n=e,r=w("big5"),9552===n||9566===n||9569===n||9578===n||21313===n||21317===n?r.lastIndexOf(n):d(n,r));if(null===i)return p(e);var o=l(i/157)+129;if(o<161)return p(e);var s=i%157;return[o,s+(s<63?64:98)]}}function P(t){var i=t.fatal,o=!1,s=0;this.handler=function(t,e){if(-1===e&&0!==s)return s=0,b(i);if(-1===e&&0===s)return-1;if(142===s&&m(e,161,223))return s=0,65377+e-161;if(143===s&&m(e,161,254))return o=!0,s=e,null;if(0===s)return u(e)?e:142===e||143===e||m(e,161,254)?(s=e,null):b(i);var n=s;s=0;var r=null;return m(n,161,254)&&m(e,161,254)&&(r=S(94*(n-161)+(e-161),w(o?"jis0212":"jis0208"))),o=!1,m(e,161,254)||t.prepend(e),null===r?b(i):r}}function R(t){t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(c(e))return e;if(165===e)return 92;if(8254===e)return 126;if(m(e,65377,65439))return[142,e-65377+161];8722===e&&(e=65293);var n=d(e,w("jis0208"));return null===n?p(e):[l(n/94)+161,n%94+161]}}function E(t){var s=t.fatal,a=0,l=1,c=2,u=3,h=4,p=5,f=6,d=a,g=a,v=0,y=!1;this.handler=function(t,e){switch(d){default:case a:return 27===e?(d=p,null):m(e,0,127)&&14!==e&&15!==e&&27!==e?(y=!1,e):-1===e?-1:(y=!1,b(s));case l:return 27===e?(d=p,null):92===e?(y=!1,165):126===e?(y=!1,8254):m(e,0,127)&&14!==e&&15!==e&&27!==e&&92!==e&&126!==e?(y=!1,e):-1===e?-1:(y=!1,b(s));case c:return 27===e?(d=p,null):m(e,33,95)?(y=!1,65377+e-33):-1===e?-1:(y=!1,b(s));case u:return 27===e?(d=p,null):m(e,33,126)?(y=!1,v=e,d=h,null):-1===e?-1:(y=!1,b(s));case h:if(27===e)return d=p,b(s);if(m(e,33,126)){d=u;var n=S(94*(v-33)+e-33,w("jis0208"));return null===n?b(s):n}return-1===e?(d=u,t.prepend(e),b(s)):(d=u,b(s));case p:return 36===e||40===e?(v=e,d=f,null):(t.prepend(e),y=!1,d=g,b(s));case f:var r=v;v=0;var i=36!==r||64!==e&&66!==e?40===r&&73===e?c:40===r&&74===e?l:40===r&&66===e?a:null:u;if(null===i)return t.prepend([r,e]),y=!1,d=g,b(s);d=i;var o=y;return y=!0,o?b(s):null}}}function L(t){t.fatal;var r=0,i=1,o=2,s=r;this.handler=function(t,e){if(-1===e&&s!==r)return t.prepend(e),s=r,[27,40,66];if(-1===e&&s===r)return-1;if(!(s!==r&&s!==i||14!==e&&15!==e&&27!==e))return p(65533);if(s===r&&c(e))return e;if(s===i&&(c(e)&&92!==e&&126!==e||165==e||8254==e)){if(c(e))return e;if(165===e)return 92;if(8254===e)return 126}if(c(e)&&s!==r)return t.prepend(e),s=r,[27,40,66];if((165===e||8254===e)&&s!==i)return t.prepend(e),s=i,[27,40,74];8722===e&&(e=65293);var n=d(e,w("jis0208"));return null===n?p(e):s!==o?(t.prepend(e),s=o,[27,36,66]):[l(n/94)+33,n%94+33]}}function j(t){var o=t.fatal,s=0;this.handler=function(t,e){if(-1===e&&0!==s)return s=0,b(o);if(-1===e&&0===s)return-1;if(0===s)return u(e)||128===e?e:m(e,161,223)?65377+e-161:m(e,129,159)||m(e,224,252)?(s=e,null):b(o);var n=s,r=null;s=0,(m(e,64,126)||m(e,128,252))&&(r=188*(n-(n<160?129:193))+e-(e<127?64:65));var i=null===r?null:S(r,w("jis0208"));return null===i&&null!==r&&m(r,8836,10528)?57344+r-8836:(null===i&&u(e)&&t.prepend(e),null===i?b(o):i)}}function N(t){t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(c(e)||128===e)return e;if(165===e)return 92;if(8254===e)return 126;if(m(e,65377,65439))return e-65377+161;8722===e&&(e=65293);var n,r=null===(n=d(e,w("jis0208")))||m(n,8272,8835)?null:n;if(null===r)return p(e);var i=l(r/188),o=r%188;return[i+(i<31?129:193),o+(o<63?64:65)]}}function U(t){var o=t.fatal,s=0;this.handler=function(t,e){if(-1===e&&0!==s)return s=0,b(o);if(-1===e&&0===s)return-1;if(0===s)return u(e)?e:m(e,129,254)?(s=e,null):b(o);var n=s,r=null;s=0,m(e,65,254)&&(r=190*(n-129)+(e-65));var i=null===r?null:S(r,w("euc-kr"));return null===r&&u(e)&&t.prepend(e),null===i?b(o):i}}function I(t){t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(c(e))return e;var n=d(e,w("euc-kr"));return null===n?p(e):[l(n/190)+129,n%190+65]}}function k(t,e){var n=t>>8,r=255&t;return e?[n,r]:[r,n]}function J(i,t){var o=t.fatal,s=null,a=null;this.handler=function(t,e){if(-1===e&&(null!==s||null!==a))return b(o);if(-1===e&&null===s&&null===a)return-1;if(null===s)return s=e,null;var n=i?(s<<8)+e:(e<<8)+s;if((s=null)===a)return m(n,55296,56319)?(a=n,null):m(n,56320,57343)?b(o):n;var r=a;return a=null,m(n,56320,57343)?65536+1024*(r-55296)+(n-56320):(t.prepend(k(n,i)),b(o))}}function H(i,t){t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(m(e,0,65535))return k(e,i);var n=k(55296+(e-65536>>10),i),r=k(56320+(e-65536&1023),i);return n.concat(r)}}function D(t){t.fatal;this.handler=function(t,e){return-1===e?-1:u(e)?e:63360+e-128}}function q(t){t.fatal;this.handler=function(t,e){return-1===e?-1:c(e)?e:m(e,63360,63487)?e-63360+128:p(e)}}Object.defineProperty&&(Object.defineProperty(g.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),Object.defineProperty(g.prototype,"fatal",{get:function(){return"fatal"===this._error_mode}}),Object.defineProperty(g.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}})),g.prototype.decode=function(t,e){var n="object"==typeof t&&t instanceof ArrayBuffer?new Uint8Array(t):"object"==typeof t&&"buffer"in t&&t.buffer instanceof ArrayBuffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(0);e=a(e),this._do_not_flush||(this._decoder=f[this._encoding.name]({fatal:"fatal"===this._error_mode}),this._BOMseen=!1),this._do_not_flush=Boolean(e.stream);for(var r,i=new h(n),o=[];;){var s=i.read();if(-1===s)break;if(-1===(r=this._decoder.handler(i,s)))break;null!==r&&(Array.isArray(r)?o.push.apply(o,r):o.push(r))}if(!this._do_not_flush){do{if(-1===(r=this._decoder.handler(i,i.read())))break;null!==r&&(Array.isArray(r)?o.push.apply(o,r):o.push(r))}while(!i.endOfStream());this._decoder=null}return function(t){var e,n;return e=["UTF-8","UTF-16LE","UTF-16BE"],n=this._encoding.name,-1===e.indexOf(n)||this._ignoreBOM||this._BOMseen||(0<t.length&&65279===t[0]?(this._BOMseen=!0,t.shift()):0<t.length&&(this._BOMseen=!0)),function(t){for(var e="",n=0;n<t.length;++n){var r=t[n];r<=65535?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode(55296+(r>>10),56320+(1023&r)))}return e}(t)}.call(this,o)},Object.defineProperty&&Object.defineProperty(v.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),v.prototype.encode=function(t,e){t=t?String(t):"",e=a(e),this._do_not_flush||(this._encoder=s[this._encoding.name]({fatal:"fatal"===this._fatal})),this._do_not_flush=Boolean(e.stream);for(var n,r=new h(function(t){for(var e=String(t),n=e.length,r=0,i=[];r<n;){var o,s,a,l=e.charCodeAt(r);l<55296||57343<l?i.push(l):56320<=l&&l<=57343?i.push(65533):55296<=l&&l<=56319&&(r!==n-1&&56320<=(o=t.charCodeAt(r+1))&&o<=57343?(s=1023&l,a=1023&o,i.push(65536+(s<<10)+a),r+=1):i.push(65533)),r+=1}return i}(t)),i=[];;){var o=r.read();if(-1===o)break;if(-1===(n=this._encoder.handler(r,o)))break;Array.isArray(n)?i.push.apply(i,n):i.push(n)}if(!this._do_not_flush){for(;-1!==(n=this._encoder.handler(r,r.read()));)Array.isArray(n)?i.push.apply(i,n):i.push(n);this._encoder=null}return new Uint8Array(i)},s["UTF-8"]=function(t){return new y(t)},f["UTF-8"]=function(t){return new e(t)},"encoding-indexes"in r&&t.forEach(function(t){"Legacy single-byte encodings"===t.heading&&t.encodings.forEach(function(t){var e=t.name,n=w(e.toLowerCase());f[e]=function(t){return new _(n,t)},s[e]=function(t){return new T(n,t)}})}),f.GBK=function(t){return new x(t)},s.GBK=function(t){return new O(t,!0)},s.gb18030=function(t){return new O(t)},f.gb18030=function(t){return new x(t)},s.Big5=function(t){return new A(t)},f.Big5=function(t){return new C(t)},s["EUC-JP"]=function(t){return new R(t)},f["EUC-JP"]=function(t){return new P(t)},s["ISO-2022-JP"]=function(t){return new L(t)},f["ISO-2022-JP"]=function(t){return new E(t)},s.Shift_JIS=function(t){return new N(t)},f.Shift_JIS=function(t){return new j(t)},s["EUC-KR"]=function(t){return new I(t)},f["EUC-KR"]=function(t){return new U(t)},s["UTF-16BE"]=function(t){return new H(!0,t)},f["UTF-16BE"]=function(t){return new J(!0,t)},s["UTF-16LE"]=function(t){return new H(!1,t)},f["UTF-16LE"]=function(t){return new J(!1,t)},s["x-user-defined"]=function(t){return new q(t)},f["x-user-defined"]=function(t){return new D(t)},r.TextEncoder||(r.TextEncoder=v),r.TextDecoder||(r.TextDecoder=g),"undefined"!=typeof module&&module.exports&&(module.exports={TextEncoder:r.TextEncoder,TextDecoder:r.TextDecoder,EncodingIndexes:r["encoding-indexes"]})}(this),function(){"use strict";var i,o,h,u,t="2.0.1",e="cmi5.js",n="A JavaScript library implementing the cmi5 specification for AUs during runtime.",s={},a="LMS.LaunchData",l="Normal",c="cmi5LearnerPreferences",r=new TinCan.Activity({id:"https://w3id.org/xapi/cmi5/context/categories/cmi5"}),p=new TinCan.Activity({id:"https://w3id.org/xapi/cmi5/context/categories/moveon"}),f=new TinCan.Activity({id:"http://id.tincanapi.com/activity/software/"+e+"/"+t,definition:{name:{und:e+" ("+t+")"},description:{en:n},type:"http://id.tincanapi.com/activitytype/source"}}),d="https://w3id.org/xapi/cmi5/context/extensions/masteryscore",g="http://adlnet.gov/expapi/verbs/initialized",v="http://adlnet.gov/expapi/verbs/terminated",y="http://adlnet.gov/expapi/verbs/completed",m={},b=["endpoint","fetch","actor","activityId","registration"],S=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};m[g]={en:"initialized"},m[v]={en:"terminated"},s.hasCORS=!1,s.useXDR=!1,"undefined"!=typeof XMLHttpRequest&&void 0!==(new XMLHttpRequest).withCredentials?s.hasCORS=!0:"undefined"!=typeof XDomainRequest&&(s.hasCORS=!0,s.useXDR=!0),(Cmi5=function(t){var e,n;if(this.log("constructor",t),void 0!==t){for(e=new URI(t).search(!0),n=0;n<b.length;n+=1)if(void 0===e[b[n]]||""===e[b[n]])throw new Error("Invalid launch string missing or empty parameter: "+b[n]);this.setFetch(e.fetch),this.setLRS(e.endpoint),this.setActor(e.actor),this.setActivity(e.activityId),this.setRegistration(e.registration)}}).VERSION=t,Cmi5.DEBUG=!1,Cmi5.prototype={_fetch:null,_endpoint:null,_actor:null,_registration:null,_activity:null,_lrs:null,_fetchRequest:null,_fetchContent:null,_lmsLaunchData:null,_contextTemplate:null,_learnerPrefs:null,_isActive:!1,_initialized:null,_passed:null,_failed:null,_completed:null,_terminated:null,_durationStart:null,_progress:null,_includeSourceActivity:!0,start:function(n,r,t){var i=this,o=t.breakBeforeInitializeStatement||!1;this.log("start"),r=r||{},i.postFetch(function(t){var e="Failed to start AU - ";void 0!==r.postFetch&&r.postFetch.apply(this,arguments),null===t?i.loadLMSLaunchData(function(t){void 0!==r.launchData&&r.launchData.apply(this,arguments),null===t?i.loadLearnerPrefs(function(t){void 0!==r.learnerPrefs&&r.learnerPrefs.apply(this,arguments),null===t?o?n(null):i.initialize(function(t){void 0!==r.initializeStatement&&r.initializeStatement.apply(this,arguments),n(null===t?null:new Error(e+" send initialized statement: "+t))}):n(new Error(e+" load learner preferences: "+t))}):n(new Error(e+" load LMS LaunchData: "+t))}):n(new Error(e+" POST to fetch: "+t))})},postFetch:function(o){var t,s=this;if(this.log("postFetch"),null!==this._fetch)return o&&(t=function(e,n){var t,r,i=n.responseText;if(s.log("postFetch::cbWrapper"),s.log("postFetch::cbWrapper",e),s.log("postFetch::cbWrapper",n),null===e){try{t=JSON.parse(i)}catch(t){return s.log("postFetch::cbWrapper - failed to parse JSON response: "+t),void o(new Error("Post fetch response malformed: failed to parse JSON response ("+t+")"),n)}if(null===t||"object"!=typeof t||void 0===t["auth-token"])return s.log("postFetch::cbWrapper - failed to access 'auth-token' property"),void o(new Error("Post fetch response malformed: failed to access 'auth-token' in ("+i+")"),n,t);s._fetchContent=t,s._lrs.auth="Basic "+t["auth-token"],o(e,n,t)}else{if(0===e)e="Aborted, offline, or invalid CORS endpoint";else if(/^\d+$/.test(e))if(void 0!==n.getResponseHeader?r=n.getResponseHeader("Content-Type"):void 0!==n.contentType&&(r=n.contentType),TinCan.Utils.isApplicationJSON(r))try{e=void 0!==(t=JSON.parse(i))["error-text"]?t["error-text"]+" ("+t["error-code"]+")":"Failed to detect 'error-text' property in JSON error response"}catch(t){e="Failed to parse JSON error response: "+t}else e=n.responseText;else e=n.responseText;o(new Error(e),n,t)}}),this._fetchRequest(this._fetch,{method:"POST"},t);o(new Error("Can't POST to fetch URL without setFetch"))},loadLMSLaunchData:function(n){var r=this;this.log("loadLMSLaunchData"),null!==this._fetchContent?this._lrs.retrieveState(a,{activity:this._activity,agent:this._actor,registration:this._registration,callback:function(t,e){null===t?null!==e?(r._lmsLaunchData=e.contents,r._contextTemplate=JSON.stringify(r._lmsLaunchData.contextTemplate),n(null,e)):n(new Error(a+" State not found"),e):n(new Error("Failed to retrieve "+a+" State: "+t),e)}}):n(new Error("Can't retrieve LMS Launch Data without successful postFetch"))},loadLearnerPrefs:function(n){var r=this;this.log("loadLearnerPrefs"),null!==this._lmsLaunchData?this._lrs.retrieveAgentProfile(c,{agent:this._actor,callback:function(t,e){null===t?(r._learnerPrefs=null!==e?e:new TinCan.AgentProfile({id:c,contentType:"application/json",contents:{}}),n(null,e)):n(new Error("Failed to retrieve "+c+" Agent Profile"+t),e)}}):n(new Error("Can't retrieve Learner Preferences without successful loadLMSLaunchData"))},saveLearnerPrefs:function(n){var t,e,r=this;return this.log("saveLearnerPrefs"),null===this._learnerPrefs?(t=new Error("Can't save Learner Preferences without first loading them"),n?void n(t):t):(n&&(e=function(t,e){r.log("saveLearnerPrefs - saveAgentProfile callback",t,e),null===t?(r._learnerPrefs.etag=TinCan.Utils.getSHA1String("object"==typeof r._learnerPrefs.contents&&TinCan.Utils.isApplicationJSON(r._learnerPrefs.contentType)?JSON.stringify(r._learnerPrefs.contents):r._learnerPrefs.contents),n(null,e)):n(new Error("Failed to save "+c+" Agent Profile: "+t),e)}),t=this._lrs.saveAgentProfile(c,this._learnerPrefs.contents,{agent:this._actor,lastSHA1:this._learnerPrefs.etag,contentType:this._learnerPrefs.contentType,callback:e}),e?void 0:null!==t.err?new Error("Failed to save "+c+" Agent Profile: "+t.err):void(r._learnerPrefs.etag=TinCan.Utils.getSHA1String("object"==typeof r._learnerPrefs.contents&&TinCan.Utils.isApplicationJSON(r._learnerPrefs.contentType)?JSON.stringify(r._learnerPrefs.contents):r._learnerPrefs.contents)))},initialize:function(e,t){var n,r,i,o,t=t||{};if(this.log("initialize"),null===this._learnerPrefs){if(r=new Error("Can't send initialized statement without successful loadLearnerPrefs"),e)return void e(r);throw r}if(this._initialized){if(this.log("initialize - already initialized"),r=new Error("AU already initialized"),e)return void e(r);throw r}return n=this.initializedStatement(),this._appendProvidedProperties(n,t),e&&(i=function(t){this.log("initialize - callbackWrapper: "+t),null===t&&(this._initialized=!0,this._isActive=!0,this._durationStart=(new Date).getTime()),e.apply(this,arguments)}.bind(this)),o=this.sendStatement(n,i),this.log("initialize - result: ",o),e||null!==o.response.err||(this._initialized=!0,this._isActive=!0,this._durationStart=(new Date).getTime()),o},terminate:function(e,t){var n,r,i,o,t=t||{};if(this.log("terminate"),!this._initialized){if(this.log("terminate - not initialized"),r=new Error("AU not initialized"),e)return void e(r);throw r}if(this._terminated){if(this.log("terminate - already terminated"),r=new Error("AU already terminated"),e)return void e(r);throw r}return n=this.terminatedStatement(t),e&&(i=function(t){this.log("terminate - callbackWrapper: "+t),null===t&&(this._terminated=!0,this._isActive=!1),e.apply(this,arguments)}.bind(this)),o=this.sendStatement(n,i),this.log("terminate - result: ",o),e||null!==o.response.err||(this._terminated=!0,this._isActive=!1),o},completed:function(e,t){var n,r,i,o,t=t||{};if(this.log("completed"),!this.isActive()){if(this.log("completed - not active"),r=new Error("AU not active"),e)return void e(r);throw r}if(this.getLaunchMode()!==l){if(this.log("completed - non-Normal launch mode: ",this.getLaunchMode()),r=new Error("AU not in Normal launch mode"),e)return void e(r);throw r}if(this._completed){if(this.log("completed - already completed"),r=new Error("AU already completed"),e)return void e(r);throw r}return n=this.completedStatement(t),e&&(i=function(t){this.log("completed - callbackWrapper: "+t),null===t&&(this.setProgress(null),this._completed=!0),e.apply(this,arguments)}.bind(this)),o=this.sendStatement(n,i),this.log("completed - result: ",o),e||null!==o.response.err||(this.setProgress(null),this._completed=!0),o},passed:function(t,e){var n,r,i,o;if(this.log("passed"),!this.isActive()){if(this.log("passed - not active"),r=new Error("AU not active"),e)return void e(r);throw r}if(this.getLaunchMode()!==l){if(this.log("passed - non-Normal launch mode: ",this.getLaunchMode()),r=new Error("AU not in Normal launch mode"),e)return void e(r);throw r}if(null!==this._passed){if(this.log("passed - already passed"),r=new Error("AU already passed"),e)return void e(r);throw r}try{n=this.passedStatement(t)}catch(t){if(this.log("passed - failed to create passed statement: "+t),e)return void e("Failed to create passed statement - "+t);throw t}return e&&(i=function(t){this.log("passed - callbackWrapper: "+t),null===t&&(this._passed=!0),e.apply(this,arguments)}.bind(this)),o=this.sendStatement(n,i),this.log("passed - result: ",o),e||null!==o.response.err||(this._passed=!0),o},failed:function(t,e){var n,r,i,o;if(this.log("failed"),!this.isActive()){if(this.log("failed - not active"),r=new Error("AU not active"),e)return void e(r);throw r}if(this.getLaunchMode()!==l){if(this.log("failed - non-Normal launch mode: ",this.getLaunchMode()),r=new Error("AU not in Normal launch mode"),e)return void e(r);throw r}if(null!==this._failed||null!==this._passed){if(this.log("failed - already passed/failed"),r=new Error("AU already passed/failed"),e)return void e(r);throw r}try{n=this.failedStatement(t)}catch(t){if(this.log("failed - failed to create failed statement: "+t),e)return void e("Failed to create failed statement - "+t);throw t}return e&&(i=function(t){this.log("failed - callbackWrapper: "+t),null===t&&(this._failed=!0),e.apply(this,arguments)}.bind(this)),o=this.sendStatement(n,i),this.log("failed - result: ",o),e||null!==o.response.err||(this._failed=!0),o},isActive:function(){return this.log("isActive"),this._isActive},log:function(){Cmi5.DEBUG&&"undefined"!=typeof console&&console.log&&(arguments[0]="cmi5.js:"+arguments[0],console.log.apply(console,arguments))},includeSourceActivity:function(t){this._includeSourceActivity=!!t},getLaunchMethod:function(){if(this.log("getLaunchMethod"),null===this._lmsLaunchData)throw new Error("Can't determine launchMethod until LMS LaunchData has been loaded");return this._lmsLaunchData.launchMethod},getLaunchMode:function(){if(this.log("getLaunchMode"),null===this._lmsLaunchData)throw new Error("Can't determine launchMode until LMS LaunchData has been loaded");return this._lmsLaunchData.launchMode},getLaunchParameters:function(){var t=null;if(this.log("getLaunchParameters"),null===this._lmsLaunchData)throw new Error("Can't determine LaunchParameters until LMS LaunchData has been loaded");return void 0!==this._lmsLaunchData.launchParameters&&(t=this._lmsLaunchData.launchParameters),t},getSessionId:function(){if(this.log("getSessionId"),null===this._lmsLaunchData)throw new Error("Can't determine session id until LMS LaunchData has been loaded");return this._lmsLaunchData.contextTemplate.extensions["https://w3id.org/xapi/cmi5/context/extensions/sessionid"]},getMoveOn:function(){if(this.log("getMoveOn"),null===this._lmsLaunchData)throw new Error("Can't determine moveOn until LMS LaunchData has been loaded");return this._lmsLaunchData.moveOn},getMasteryScore:function(){var t=null;if(this.log("getMasteryScore"),null===this._lmsLaunchData)throw new Error("Can't determine masteryScore until LMS LaunchData has been loaded");return void 0!==this._lmsLaunchData.masteryScore&&(t=this._lmsLaunchData.masteryScore),t},getReturnURL:function(){var t=null;if(this.log("getReturnURL"),null===this._lmsLaunchData)throw new Error("Can't determine returnURL until LMS LaunchData has been loaded");return void 0!==this._lmsLaunchData.returnURL&&(t=this._lmsLaunchData.returnURL),t},getEntitlementKey:function(){var t=null;if(this.log("getEntitlementKey"),null===this._lmsLaunchData)throw new Error("Can't determine entitlementKey until LMS LaunchData has been loaded");return void 0!==this._lmsLaunchData.entitlementKey&&(void 0!==this._lmsLaunchData.entitlementKey.alternate?t=this._lmsLaunchData.entitlementKey.alternate:void 0!==this._lmsLaunchData.entitlementKey.courseStructure&&(t=this._lmsLaunchData.entitlementKey.courseStructure)),t},getLanguagePreference:function(){var t=null;if(this.log("getLanguagePreference"),null===this._learnerPrefs)throw new Error("Can't determine language preference until learner preferences have been loaded");return void 0!==this._learnerPrefs.contents.languagePreference&&(t=this._learnerPrefs.contents.languagePreference),t},setLanguagePreference:function(t){if(this.log("setLanguagePreference"),null===this._learnerPrefs)throw new Error("Can't set language preference until learner preferences have been loaded");""===t&&(t=null),this._learnerPrefs.contents.languagePreference=t},getAudioPreference:function(){var t=null;if(this.log("getAudioPreference"),null===this._learnerPrefs)throw new Error("Can't determine audio preference until learner preferences have been loaded");return void 0!==this._learnerPrefs.contents.audioPreference&&(t=this._learnerPrefs.contents.audioPreference),t},setAudioPreference:function(t){if(this.log("setAudioPreference"),null===this._learnerPrefs)throw new Error("Can't set audio preference until learner preferences have been loaded");if("on"!==t&&"off"!==t&&null!==t)throw new Error("Unrecognized value for audio preference: "+t);this._learnerPrefs.contents.audioPreference=t},getDuration:function(){return this.log("getDuration"),(new Date).getTime()-this._durationStart},setProgress:function(t){if(this.log("setProgress: ",t),null!==t){if(!S(t))throw new Error("Invalid progress measure (not an integer): "+t);if(t<0||100<t)throw new Error("Invalid progress measure must be greater than or equal to 0 and less than or equal to 100: "+t)}this._progress=t},getProgress:function(){return this.log("getProgress"),this._progress},setFetch:function(t){var e,n,r;if(this.log("setFetch: ",t),this._fetch=t,this._fetchRequest=i,null===(e=t.toLowerCase().match(/([A-Za-z]+:)\/\/([^:/]+):?(\d+)?(\/.*)?$/)))throw new Error("URL invalid: failed to divide URL parts");if(r=location.port,n=location.protocol.toLowerCase()===e[1],""===r&&(r="http:"===location.protocol.toLowerCase()?"80":"https:"===location.protocol.toLowerCase()?"443":""),!n||location.hostname.toLowerCase()!==e[2]||r!==(null!==e[3]&&void 0!==e[3]&&""!==e[3]?e[3]:"http:"===e[1]?"80":"https:"===e[1]?"443":"")){if(!s.hasCORS)throw this.log("[error] URL invalid: cross domain requests not supported in this browser"),new Error("URL invalid: cross domain requests not supported in this browser");if(s.useXDR&&n)this._fetchRequest=o;else if(s.useXDR&&!n)throw this.log("[error] URL invalid: cross domain request for differing scheme in IE with XDR"),new Error("URL invalid: cross domain request for differing scheme in IE with XDR")}},getFetch:function(){return this._fetch},setLRS:function(t,e){this.log("setLRS: ",t,e),null!==this._lrs?((void 0===e&&null===t||null!==t)&&(this._endpoint=this._lrs.endpoint=t),null!=e&&(this._lrs.auth=e)):this._lrs=new TinCan.LRS({endpoint:t,auth:e,allowFail:!1})},getLRS:function(){return this._lrs},setActor:function(t){if(t instanceof TinCan.Agent||(t=TinCan.Agent.fromJSON(t)),!(null!==t.account&&t.account instanceof TinCan.AgentAccount))throw new Error("Invalid actor: missing or invalid account");if(null===t.account.name)throw new Error("Invalid actor: name is null");if(""===t.account.name)throw new Error("Invalid actor: name is empty");if(null===t.account.homePage)throw new Error("Invalid actor: homePage is null");if(""===t.account.homePage)throw new Error("Invalid actor: homePage is empty");this._actor=t},getActor:function(){return this._actor},setActivity:function(t){if(t instanceof TinCan.Activity||(t=new TinCan.Activity({id:t})),null===t.id)throw new Error("Invalid activity: id is null");if(""===t.id)throw new Error("Invalid activity: id is empty");this._activity=t},getActivity:function(){return this._activity},setRegistration:function(t){if(null===t)throw new Error("Invalid registration: null");if(""===t)throw new Error("Invalid registration: empty");this._registration=t},getRegistration:function(){return this._registration},validateScore:function(t){if(null==t)throw new Error("cannot validate score (score not provided): "+t);if(void 0!==t.min&&!S(t.min))throw new Error("score.min is not an integer");if(void 0!==t.max&&!S(t.max))throw new Error("score.max is not an integer");if(void 0!==t.scaled){if(!/^(-|\+)?[01]+(\.[0-9]+)?$/.test(t.scaled))throw new Error("scaled score not a recognized number: "+t.scaled);if(t.scaled<0)throw new Error("scaled score must be greater than or equal to 0");if(1<t.scaled)throw new Error("scaled score must be less than or equal to 1")}if(void 0!==t.raw){if(!S(t.raw))throw new Error("score.raw is not an integer");if(void 0===t.min)throw new Error("minimum score must be provided when including a raw score");if(void 0===t.max)throw new Error("maximum score must be provided when including a raw score");if(t.raw<t.min)throw new Error("raw score must be greater than or equal to minimum score");if(t.raw>t.max)throw new Error("raw score must be less than or equal to maximum score")}return!0},prepareStatement:function(t){var e={actor:this._actor,verb:{id:t},target:this._activity,context:this._prepareContext()},n=this.getProgress();return void 0!==m[t]&&(e.verb.display=m[t]),t!==y&&null!==n&&(e.result={extensions:{"https://w3id.org/xapi/cmi5/result/extensions/progress":n}}),new TinCan.Statement(e)},sendStatement:function(n,r){var t,e;if(r&&(t=function(t,e){null===t?r(t,e,n):r(new Error(t),e)}),e=this._lrs.saveStatement(n,{callback:t}),!r)return{response:e,statement:n}},initializedStatement:function(){return this.log("initializedStatement"),this._prepareStatement(g)},terminatedStatement:function(t){var e=this._prepareStatement(v),t=t||{};return this.log("terminatedStatement"),e.result=e.result||new TinCan.Result,e.result.duration=TinCan.Utils.convertMillisecondsToISO8601Duration(this.getDuration()),this._appendProvidedProperties(e,t),e},passedStatement:function(t){var e,n=this._prepareStatement("http://adlnet.gov/expapi/verbs/passed");if(this.log("passedStatement"),n.result=n.result||new TinCan.Result,n.result.success=!0,n.result.duration=TinCan.Utils.convertMillisecondsToISO8601Duration(this.getDuration()),t){try{this.validateScore(t)}catch(t){throw new Error("Invalid score - "+t)}if(null!==(e=this.getMasteryScore())&&void 0!==t.scaled){if(t.scaled<e)throw new Error("Invalid score - scaled score does not meet or exceed mastery score ("+t.scaled+" < "+e+")");n.context.extensions=n.context.extensions||{},n.context.extensions[d]=e}n.result.score=new TinCan.Score(t)}return n.context.contextActivities.category.push(p),n},failedStatement:function(t){var e,n=this._prepareStatement("http://adlnet.gov/expapi/verbs/failed");if(this.log("failedStatement"),n.result=n.result||new TinCan.Result,n.result.success=!1,n.result.duration=TinCan.Utils.convertMillisecondsToISO8601Duration(this.getDuration()),t){try{this.validateScore(t)}catch(t){throw new Error("Invalid score - "+t)}if(null!==(e=this.getMasteryScore())&&void 0!==t.scaled){if(t.scaled>=e)throw new Error("Invalid score - scaled score exceeds mastery score ("+t.scaled+" >= "+e+")");n.context.extensions=n.context.extensions||{},n.context.extensions[d]=e}n.result.score=new TinCan.Score(t)}return n.context.contextActivities.category.push(p),n},completedStatement:function(t){var e=this._prepareStatement(y),t=t||{};return this.log("completedStatement"),e.result=e.result||new TinCan.Result,e.result.completion=!0,e.result.duration=TinCan.Utils.convertMillisecondsToISO8601Duration(this.getDuration()),e.context.contextActivities.category.push(p),this._appendProvidedProperties(e,t),e},_prepareContext:function(){var t=JSON.parse(this._contextTemplate);return t.registration=this._registration,this._includeSourceActivity&&(t.contextActivities=t.contextActivities||new TinCan.ContextActivities,t.contextActivities.other=t.contextActivities.other||[],t.contextActivities.other.push(f)),t},_prepareStatement:function(t){var e=this.prepareStatement(t);return e.context.contextActivities=e.context.contextActivities||new TinCan.ContextActivities,e.context.contextActivities.category=e.context.contextActivities.category||[],e.context.contextActivities.category.push(r),e},_appendProvidedProperties:function(t,e){var n;if(void 0!==e.context&&void 0!==e.context.extensions)for(n in e.context.extensions)e.context.extensions.hasOwnProperty(n)&&(t.context.extensions[n]=e.context.extensions[n]);if(void 0!==e.result&&(t.result=t.result||new TinCan.Result,t.result.extensions=t.result.extensions||{},void 0!==e.result.extensions))for(n in e.result.extensions)e.result.extensions.hasOwnProperty(n)&&(t.result.extensions[n]=e.result.extensions[n]);if(void 0!==e.target&&void 0!==e.target.definition&&(t.target.definition=t.target.definition||new TinCan.ActivityDefinition,void 0!==e.target.definition.type&&(t.target.definition.type=e.target.definition.type),void 0!==e.target.definition.extensions))for(n in t.target.definition.extensions=t.target.definition.extensions||{},e.target.definition.extensions)e.target.definition.extensions.hasOwnProperty(n)&&(t.target.definition.extensions[n]=e.target.definition.extensions[n])}},Cmi5.enableDebug=function(t){Cmi5.DEBUG=!0,t&&TinCan.enableDebug()},Cmi5.disableDebug=function(t){Cmi5.DEBUG=!1,t&&TinCan.disableDebug()},h=function(t,e,n,r){var i,o,s;return this.log("requestComplete: "+n.finished+", xhr.status: "+t.status),s=void 0===t.status?n.fakeStatus:1223===t.status?204:t.status,n.finished?i:(n.finished=!0,o=e.ignore404&&404===s,200<=s&&s<400||o?r?void r(null,t):i={err:null,xhr:t}:(i={err:s,xhr:t},0===s?this.log("[warning] There was a problem communicating with the server. Aborted, offline, or invalid CORS endpoint ("+s+")"):this.log("[warning] There was a problem communicating with the server. ("+s+" | "+t.responseText+")"),r&&r(s,t),i))},i=function(t,e,n){var r,i,o,s,a=this,l=[],c={finished:!1,fakeStatus:null},u=t;for(i in this.log("sendRequest using XMLHttpRequest - async: "+void 0),(e=e||{}).params=e.params||{},e.headers=e.headers||{},s=void 0!==n,e.params)e.params.hasOwnProperty(i)&&l.push(i+"="+encodeURIComponent(e.params[i]));for(i in 0<l.length&&(u+="?"+l.join("&")),(r=new XMLHttpRequest).open(e.method,u,s),e.headers)e.headers.hasOwnProperty(i)&&r.setRequestHeader(i,e.headers[i]);void 0!==e.data&&(e.data+=""),o=e.data,s&&(r.onreadystatechange=function(){a.log("xhr.onreadystatechange - xhr.readyState: "+r.readyState),4===r.readyState&&h.call(a,r,e,c,n)});try{r.send(o)}catch(t){this.log("sendRequest caught send exception: "+t)}if(!s)return h.call(this,r,e,c)},o=function(t,e,n){var r,i,o,s,a=this,l=[],c={finished:!1,fakeStatus:null};if(this.log("sendRequest using XDomainRequest"),(e=e||{}).params=e.params||{},e.headers=e.headers||{},void 0!==e.headers["Content-Type"]&&"application/json"!==e.headers["Content-Type"])return s=new Error("Unsupported content type for IE Mode request"),n?(n(s,null),null):{err:s,xhr:null};for(i in e.params)e.params.hasOwnProperty(i)&&l.push(i+"="+encodeURIComponent(e.params[i]));0<l.length&&(t+="?"+l.join("&")),(r=new XDomainRequest).open("POST",t),n?(r.onload=function(){c.fakeStatus=200,h.call(a,r,e,c,n)},r.onerror=function(){c.fakeStatus=400,h.call(a,r,e,c,n)},r.ontimeout=function(){c.fakeStatus=0,h.call(a,r,e,c,n)}):(r.onload=function(){c.fakeStatus=200},r.onerror=function(){c.fakeStatus=400},r.ontimeout=function(){c.fakeStatus=0}),r.onprogress=function(){},r.timeout=0;try{r.send(void 0)}catch(t){this.log("sendRequest caught send exception: "+t)}if(!n){for(o=1e4+Date.now(),this.log("sendRequest - until: "+o+", finished: "+c.finished);Date.now()<o&&null===c.fakeStatus;)u();return h.call(a,r,e,c)}},u=function(){var t=new XMLHttpRequest,e=window.location+"?forcenocache="+TinCan.Utils.getUUID();t.open("GET",e,!1),t.send(null)}}();
//# sourceMappingURL=cmi5-min.js.map